<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cápsula do Tempo - João Elias & Gabriely</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <style>
    /* --- [MANTIDO] TODOS OS ESTILOS EXISTENTES --- */
    @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Great+Vibes&family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;500;600&display=swap');
    :root {
      --primary-gradient: linear-gradient(135deg, #1e3a8a 0%, #f43f5e 100%);
      --secondary-gradient: linear-gradient(135deg, #f43f5e 0%, #1e3a8a 100%);
      --card-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
   /* --- CORRIGIDO: Wrapper para fundo fixo com imagem HTML --- */
.bg-wrapper {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: -1;
  background: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.2)),
              url('CasamentoJ&G.jpeg');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-blend-mode: multiply;
  opacity: 0;
  transition: opacity 1s ease-in-out;
}

@media (max-aspect-ratio: 9/16) {
  .bg-wrapper {
    background-position: center 30%;
  }
}

.bg-wrapper.loaded {
  opacity: 1;
}

.glass-header {
  background-color: rgba(255, 255, 255, 0.3);
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 2rem;
  padding: 2rem;
  margin-bottom: 2rem;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.text-rose-600 {
  font-family: 'Great Vibes', cursive !important;
  font-weight: 400;
  letter-spacing: 1px;
}

body {
  font-family: 'Poppins', sans-serif;
  color: #1e293b;
  margin: 0;
  padding: 0;
}

/* Fonte principal do cabeçalho: elegante e legível */
.glass-header h1,
.glass-header h2 {
  font-family: 'Playfair Display', 'Great Vibes', 'Dancing Script', cursive;
  font-weight: 600;
}

/* Fonte do subtítulo (data e frase) */
.glass-header p {
  font-family: 'Poppins', sans-serif;
  font-weight: 400;
}

.container {
  max-width: 960px;
  margin: auto;
  padding: 0 1rem 2rem 1rem;
}

/* Classes utilitárias Tailwind-like */
.text-center { text-align: center; }
.mb-12 { margin-bottom: 3rem; }
.text-5xl { font-size: 3rem; line-height: 1; }
.font-bold { font-weight: 700; }
.text-slate-700 { color: #334155; }
.mb-2 { margin-bottom: 0.5rem; }
.text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
.font-semibold { font-weight: 600; }
.text-rose-600 { color: #f43f5e; }
.text-xl { font-size: 1.25rem; line-height: 1.75rem; }
.mb-4 { margin-bottom: 1rem; }
.text-lg { font-size: 1.125rem; line-height: 1.75rem; }
.italic { font-style: italic; }
.max-w-2xl { max-width: 42rem; margin: auto; }
.max-w-3xl { max-width: 48rem; margin: auto; }
.rounded-3xl { border-radius: 2rem; }
.shadow-2xl { box-shadow: var(--card-shadow); }
.p-8 { padding: 2rem; }
.w-full { width: 100%; }
.border { border-width: 1px; }
.border-gray-300 { border-color: #d1d5db; }
.px-4 { padding-left: 1rem; padding-right: 1rem; }
.py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
.rounded-lg { border-radius: 0.5rem; }
.bg-white { background-color: #fff; }
.text-gray-800 { color: #1f2937; }
.text-white { color: #fff; }
.px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
.py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
.font-medium { font-weight: 500; }
.transition-all { transition: var(--transition); } transition: var(--transition); }
    .spinner-icon { animation: spin 1s linear infinite; display: inline-block; margin-right: 8px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .success-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--primary-gradient);
      color: white;
      padding: 20px;
      border-radius: 1rem;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      z-index: 1000;
      text-align: center;
      opacity: 1;
      transition: opacity 0.5s;
      max-width: 90%;
      width: 350px;
    }
    .success-popup.hidden { opacity: 0; pointer-events: none; }
    #gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1rem;
    }
    #gallery .media-container {
      position: relative;
      border-radius: 1rem;
      overflow: hidden;
      aspect-ratio: 1/1;
      background: #f1f5f9;
      transition: var(--transition);
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      cursor: pointer;
    }
    #gallery .media-container:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px rgba(0,0,0,0.1);
    }
    #gallery img, #gallery video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .video-thumbnail {
      position: relative;
      width: 100%;
      height: 100%;
      background-color: #f1f5f9;
      border-radius: 1rem;
      overflow: hidden;
    }
    .video-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 1rem;
    }
    .video-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 2rem;
      z-index: 1;
      transition: all 0.3s ease;
    }
    .video-overlay:hover {
      background: rgba(0,0,0,0.5);
      transform: scale(1.05);
    }
    .media-info {
      padding: 0.5rem;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 0 0 1rem 1rem;
      position: relative;
      z-index: 2;
      max-height: 60px;
      overflow: hidden;
    }
    .media-info .text-xs {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      font-size: 0.75rem;
      line-height: 1.2;
    }
    /* --- NOVO: Estilo para a mensagem abaixo do nome --- */
    .media-info .message-text {
      font-size: 0.65rem;
      line-height: 1.3;
      color: #64748b;
      white-space: normal;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-top: 2px;
    }
    #lightboxOverlay {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      flex-direction: column;
      padding: 0;
    }
    #lightboxContent {
      width: 100%;
      height: 100%;
      position: relative;
    }
    #lightboxImage, #lightboxVideo {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 1rem;
      box-shadow: 0 20px 25px rgba(0,0,0,0.3);
    }
    #lightboxCaption {
      color: #fff;
      text-align: center;
      font-size: 1.1rem;
      margin-top: 1rem;
      max-width: 80%;
    }
    .navButton {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      color: white;
      font-size: 2rem;
      background: rgba(0,0,0,0.3);
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      cursor: pointer;
      user-select: none;
      transition: var(--transition);
      z-index: 2500;
    }
    .navButton:hover {
      background: rgba(0,0,0,0.5);
    }
    #prevBtn { left: 1rem; }
    #nextBtn { right: 1rem; }
    .close-lightbox {
      position: absolute;
      top: 1rem;
      right: 1rem;
      color: white;
      font-size: 2rem;
      cursor: pointer;
      background: rgba(0,0,0,0.3);
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
      z-index: 3000;
    }
    .close-lightbox:hover {
      background: rgba(0,0,0,0.5);
    }
    /* Estilos para os botões de alternância - CARTÕES INDIVIDUAIS */
    .toggle-btn {
      flex: 1;
      padding: 1rem;
      background-color: #e2e8f0;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      font-family: 'Poppins', sans-serif;
      border-top: 4px solid transparent;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      border-radius: 1.5rem;
      position: relative;
      overflow: hidden;
    }
    .toggle-btn.active {
      background: var(--primary-gradient);
      color: white;
      border-top-color: #f43f5e;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }
    .toggle-btn.photo {
      border-top-color: #f43f5e;
    }
    .toggle-btn.message {
      border-top-color: #00fbfe;
    }
    /* Animação de bounce ao clicar */
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
      40% {transform: translateY(-10px);}
      60% { transform: translateY(-5px);}
    }
    .toggle-btn.bounce {
      animation: bounce 0.5s;
    }
    .form-section {
      display: none;
    }
    .form-section.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    /* Estilos para os botões de foto/vídeo - ALINHAMENTO INTERNO CORRIGIDO */
    .media-btn {
      flex: 1;
      background: rgba(0, 0, 0, 0.64);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      aspect-ratio: 1 / 1;
      min-height: 150px;
      padding: 1rem 0.8rem;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
      color: white;
      font-weight: 600;
      overflow: hidden;
    }
    .media-btn:hover {
      background: rgba(255, 255, 255, 0.35);
      transform: translateY(-3px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
    }
    .media-btn i {
      font-size: 2rem;
      color: #94a3b8;
    }
    .media-btn:hover i {
      color: #e2e8f0;
    }
    .media-btn small {
      display: block;
      color: #64748b;
      font-size: 0.75rem;
      line-height: 1.3;
      margin-top: 0;
    }
    /* Estilos para o botão de envio com barra de progresso - REMOVIDO O BLUR */
    .send-btn {
      background: #1e293b;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 1.5rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Poppins', sans-serif;
      box-shadow: 0 4px 6px rgba(30, 58, 138, 0.2);
      position: relative;
      overflow: hidden;
    }
    .send-btn.enabled {
      background: var(--primary-gradient);
      color: white;
      box-shadow: 0 4px 6px rgba(30, 58, 138, 0.2);
    }
    .send-btn.enabled:hover:not(:disabled) {
      background: var(--secondary-gradient);
      transform: translateY(-2px);
      box-shadow: 0 10px 15px rgba(30, 58, 138, 0.3);
    }
    .send-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }
    .send-btn.sending {
      background: #94a3b8;
    }
    .send-btn.sent {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }
    /* NOVO: Container para a barra de progresso ACIMA do botão */
    .progress-wrapper {
      height: 16px;
      width: 100%;
      background-color: #e2e8f0;
      border-radius: 1.5rem;
      overflow: hidden;
      margin-bottom: 0.5rem;
      opacity: 0;
      transition: opacity 0.2s ease;
      position: relative;
    }
    .progress-wrapper.visible {
        opacity: 1;
    }
    .progress-bar {
      height: 100%;
      background: var(--primary-gradient);
      width: 0%;
      transition: width 0.3s ease;
      position: relative;
    }
    .progress-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 0.875rem;
      font-weight: bold;
      color: #1e293b;
      z-index: 2;
      pointer-events: none;
    }
    .progress-estimate {
      position: absolute;
      top: calc(100% + 4px);
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.75rem;
      color: #64748b;
      font-weight: 500;
      white-space: nowrap;
      transition: opacity 0.3s ease;
    }
    .send-btn .button-content {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .send-btn.sending .button-content {
      opacity: 0.7;
    }
    /* Input estilizado */
    .custom-input {
      border: 2px solid #e2e8f0;
      transition: var(--transition);
      padding: 0.75rem 1rem;
      border-radius: 1.5rem;
    }
    .custom-input:focus {
      border-color: #a5b4fc;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      outline: none;
    }
    /* Botão de galeria */
    .gallery-btn {
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
      border: 2px dashed #cbd5e1;
      transition: var(--transition);
      padding: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-weight: 500;
      border-radius: 1.5rem;
    }
    .gallery-btn:hover {
      background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
      border-color: #94a3b8;
    }
    /* Preview de arquivo */
    #filePreview, #messageVideoPreview {
      border-radius: 1.5rem;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    #previewContent img, #previewContent video, #messageVideoContent video {
      max-width: 100%;
      max-height: 200px;
      object-fit: contain;
    }
    /* Responsividade */
    @media (max-width: 768px) {
      .text-5xl { font-size: 2.25rem; }
      .text-3xl { font-size: 1.5rem; }
      .flex.gap-4 { flex-direction: row; }
      .media-btn { min-height: 120px; }
      #gallery { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); }
    }
    /* Estilos para abas de filtro - AJUSTADO PARA FICAR LADO A LADO */
    .filter-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }
    .filter-tab {
      padding: 0.5rem 1rem;
      background-color: #e2e8f0;
      border-radius: 1.5rem;
      cursor: pointer;
      font-weight: 500;
      transition: var(--transition);
      flex: 1;
      text-align: center;
      min-width: 150px;
    }
    .filter-tab.active {
      background: var(--primary-gradient);
      color: white;
    }
    /* Estilo para mensagem de erro */
    .error-message {
      color: #ef4444;
      font-size: 0.875rem;
      margin-top: 0.5rem;
      text-align: center;
    }
    /* Estilo para mensagem de carregamento */
    #loadingMessage {
      text-align: center;
      padding: 2rem;
      color: #64748b;
    }
    /* --- CORREÇÃO: Estilos para evitar o pulinho (SEM travar a tela) --- */
    .form-section {
        display: none;
        min-height: fit-content;
    }
    .form-section.active {
        display: block;
        animation: fadeIn 0.5s ease;
    }
    .progress-wrapper-placeholder {
        height: calc(16px + 0.5rem + 0.5rem);
        min-height: 26px;
        width: 100%;
    }
    .progress-wrapper {
        margin-bottom: 0.5rem;
        opacity: 0;
        transition: opacity 0.2s ease;
        height: 16px;
        position: relative;
    }
    .progress-wrapper.visible {
        opacity: 1;
    }
    /* --- FIM DA CORREÇÃO --- */
    /* Estilos para miniaturas de múltiplos arquivos - MELHORADOS */
    .file-thumbnails {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.75rem;
        justify-content: center;
        max-height: 120px;
        overflow-y: auto;
    }
    .file-thumbnail {
        width: 80px;
        height: 80px;
        border-radius: 0.5rem;
        overflow: hidden;
        position: relative;
        border: 2px solid #e2e8f0;
        box-sizing: border-box;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .file-thumbnail img, .file-thumbnail video {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .file-thumbnail .remove-btn {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(239, 68, 68, 0.8);
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        font-weight: bold;
        cursor: pointer;
        z-index: 10;
        border: 2px solid white;
        opacity: 0;
        transition: opacity 0.2s ease;
    }
    .file-thumbnail:hover .remove-btn {
       opacity: 1;
    }
    .file-count {
        font-size: 0.875rem;
        color: #64748b;
        font-weight: 500;
        margin-top: 0.5rem;
        text-align: center;
    }
    .preview-multi {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 200px;
        background-color: #f8fafc;
        border-radius: 0.5rem;
        margin-bottom: 0.5rem;
    }
    .preview-multi .file-count-display {
        font-size: 1.5rem;
        font-weight: bold;
        color: #94a3b8;
    }
    .preview-multi i {
        font-size: 2rem;
        color: #94a3b8;
        margin-right: 0.5rem;
    }
    /* --- OCULTAR PRÉVIA GRANDE E AJUSTAR LAYOUT DAS MINIATURAS --- */
    #previewContent, #messageVideoContent {
        display: none;
    }
    #filePreview .text-center.p-4.bg-gray-50.rounded-lg,
    #messageVideoPreview .text-center.p-4.bg-gray-50.rounded-lg {
        padding-top: 0.5rem;
    }
    .file-thumbnail.video-thumbnail-preview {
        background-color: #1e293b;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .file-thumbnail.video-thumbnail-preview::before {
        content: "▶";
        color: white;
        font-size: 1.5rem;
        opacity: 0.8;
    }
    .file-thumbnail.video-thumbnail-preview img {
        opacity: 0.7;
    }
    /* --- FIM DAS MODIFICAÇÕES DE PRÉVIA --- */
    /* Dica de uso para excluir arquivos */
    .delete-instruction {
      font-size: 0.875rem;
      color: #64748b;
      text-align: center;
      margin-bottom: 1rem;
    }
    /* EFEITO DE VIDRO (GLASSMORPHISM) - CORRIGIDO E MANTIDO */
    .glass-card {
      background-color: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.4);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      border-radius: 1.5rem;
      transition: all 0.3s ease;
    }
    .glass-card:hover {
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
      transform: translateY(-2px);
    }
    .glass-btn {
      background-color: rgba(255, 255, 255, 0.5);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.5);
      color: #1e293b;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      border-radius: 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .glass-btn:hover {
      background-color: rgba(255, 255, 255, 0.65);
      transform: translateY(-1px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }
    .glass-input {
      background-color: rgba(255, 255, 255, 0.5);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.5);
      color: #1e293b;
      padding: 0.75rem 1rem;
      border-radius: 1.5rem;
      transition: all 0.3s ease;
      width: 100%;
    }
    .glass-input:focus {
      outline: none;
      border-color: rgba(99, 102, 241, 0.8);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }
    .glass-gallery-btn {
      background-color: rgba(255, 255, 255, 0.5);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px dashed rgba(255, 255, 255, 0.6);
      color: #1e293b;
      font-weight: 500;
      padding: 1rem;
      border-radius: 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .glass-gallery-btn:hover {
      background-color: rgba(255, 255, 255, 0.65);
      border-color: rgba(99, 102, 241, 0.6);
    }
    .glass-custom {
      background-color: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 2rem;
      padding: 2.5rem 2rem;
      margin-bottom: 2.5rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
      color: #1e293b;
      text-align: center;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      border-top: 1px solid rgba(255, 255, 255, 0.3);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    button.media-btn, a.media-btn, div.media-btn,
    button.glass-btn, a.glass-btn, div.glass-btn {
      background: rgba(0, 0, 0, 0.64) !important;
      -webkit-backdrop-filter: blur(14px) !important;
      backdrop-filter: blur(14px) !important;
      border: 1px solid rgba(255, 255, 255, 0.15) !important;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5) !important;
      border-radius: 1.5rem;
      color: #ffffff !important;
      font-weight: 600;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.100);
    }
    button.media-btn small, a.media-btn small, div.media-btn small,
    button.glass-btn small, a.glass-btn small, div.glass-btn small {
      color: #f5f5f5 !important;
      font-weight: 500;
      text-shadow: 0 1px 2px rgba(0,0,0,0.7);
    }
    button.media-btn:hover, a.media-btn:hover, div.media-btn:hover,
    button.glass-btn:hover, a.glass-btn:hover, div.glass-btn:hover {
      background: rgba(0, 0, 0, 0.7) !important;
      transform: translateY(-2px);
    }
    .glass {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: 1rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
      transition: all 0.3s ease;
    }
    .glass-btn {
      composes: glass;
      color: #fff;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      cursor: pointer;
      text-shadow: 0 1px 2px rgba(0,0,0,0.6);
    }
    .glass-btn:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateY(-2px);
    }
    .glass-input {
      composes: glass;
      width: 100%;
      padding: 0.75rem 1rem;
      color: #fff;
    }
    .glass-input::placeholder {
      color: rgba(255,255,255,0.7);
    }
    .glass-input {
      background: rgba(0, 0, 0, 0.35);
      border: 1px solid rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border-radius: 1rem;
      padding: 0.75rem 1rem;
      width: 100%;
      color: #fff;
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    .glass-input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }
    .glass-input:focus {
      outline: none;
      border-color: rgba(255, 255, 255, 0.4);
      box-shadow: 0 0 0 3px rgba(0,0,0,0.3);
    }
    /* --- DESIGN ELEGANTE PARA O CABEÇALHO --- */
    .glass-header {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 2rem;
      padding: 2.5rem 2rem;
      margin-bottom: 2.5rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
      color: #1e293b;
      text-align: center;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      border-top: 1px solid rgba(255, 255, 255, 0.3);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .glass-header h1 {
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      font-size: 2.75rem;
      color: #1e293b;
      margin-bottom: 1.5rem;
      letter-spacing: -0.5px;
      position: relative;
      display: inline-block;
    }
    .glass-header h1::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 2px;
      background: linear-gradient(90deg, transparent, #d4af37, transparent);
    }
    .glass-header h2 {
      font-family: 'dancing script', cursive;
      font-size: 2.3rem;
      color: #1E293B;
      margin-bottom: 1.8rem;
      letter-spacing: 1.5px;
      font-weight: 900;
      opacity: 0.95;
    }
    .glass-header .data {
      font-family: 'dancing script', sans-serif;
      font-size: 1.3rem;
      font-weight: 500;
      color: #475569;
      margin-bottom: 2.0rem;
      text-shadow: none;
      line-height: 1.5;
    }
    .glass-header .frase {
      font-family: 'Poppins', sans-serif;
      font-size: 1.1rem;
      font-style: italic;
      color: #64748b;
      line-height: 1.7;
      max-width: 520px;
      margin: 0 auto;
      padding: 0 1rem;
      opacity: 0.92;
      letter-spacing: 0.3px;
    }
    .glass-header .frase::before {
      content: "♥ ";
      color: #f43f5e;
      font-size: 1.2em;
      vertical-align: middle;
    }
    .glass-header:hover {
      background: rgba(255, 255, 255, 0.18);
      box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
    }
    /* --- NOVOS ESTILOS PARA O BOTÃO "VER MAIS" --- */
    .view-more-btn {
      background: var(--primary-gradient);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 1.5rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-family: 'Poppins', sans-serif;
      box-shadow: 0 4px 6px rgba(30, 58, 138, 0.2);
      margin: 2rem auto 0;
      display: none;
    }
    .view-more-btn:hover {
      background: var(--secondary-gradient);
      transform: translateY(-2px);
      box-shadow: 0 10px 15px rgba(30, 58, 138, 0.3);
    }
    .hidden-item {
      display: none;
    }
    .visible-item {
      display: block;
    }
    /* --- NOVO: Estilo para as mini-abas dentro da aba de mensagem --- */
    .message-sub-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      justify-content: center;
      background: rgba(255, 255, 255, 0.1);
      padding: 0.5rem;
      border-radius: 1.5rem;
      backdrop-filter: blur(10px);
    }
    .message-sub-tab {
      padding: 0.5rem 1rem;
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 1rem;
      cursor: pointer;
      font-weight: 500;
      transition: var(--transition);
      flex: 1;
      text-align: center;
      min-width: 120px;
    }
    .message-sub-tab.active {
      background: var(--primary-gradient);
      color: white;
    }
    .message-sub-form {
      display: none;
    }
    .message-sub-form.active {
      display: block;
    }
    /* --- NOVO: Estilo para prévias de texto na galeria --- */
    .text-message-preview {
      background: white;
      border-radius: 1rem;
      padding: 1rem;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      border: 1px solid #e2e8f0;
      position: relative;
      overflow: hidden;
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    .text-message-preview .quote-mark {
      font-size: 1.5rem;
      color: #6366f1;
      position: absolute;
      top: 0.5rem;
      left: 0.5rem;
      z-index: 1;
    }
    .text-message-preview .name {
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 0.25rem;
      color: #1f2937;
    }
    .text-message-preview .message {
      font-size: 0.9rem;
      line-height: 1.5;
      color: #475569;
      word-break: break-word;
      max-height: 100px;
      overflow-y: auto;
      padding: 0.5rem 0;
      scrollbar-width: thin;
      scrollbar-color: #a0a0a0 #f1f5f9;
    }
    .text-message-preview .message::-webkit-scrollbar {
      width: 8px;
    }
    .text-message-preview .message::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 4px;
    }
    .text-message-preview .message::-webkit-scrollbar-thumb {
      background: #a0a0a0;
      border-radius: 4px;
    }
    /* --- NOVO: Estilo para o modal de mensagem de texto (card centralizado) --- */
    .text-lightbox-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      overflow: hidden;
    }
    .text-lightbox-card {
      background: white;
      border-radius: 1.5rem;
      width: 85%;
      max-width: 400px;
      padding: 2rem;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
      text-align: center;
      box-sizing: border-box;
      animation: fadeIn 0.3s ease;
      position: relative;
    }
    .text-lightbox-card .name {
      font-weight: 700;
      font-size: 1.5rem;
      color: #1e293b;
      margin-bottom: 1.5rem;
      line-height: 1.2;
    }
    .text-lightbox-card .message {
      font-size: 1.1rem;
      line-height: 1.6;
      color: #334155;
      margin-bottom: 1.5rem;
      text-align: center;
      word-break: break-word;
      max-height: 60vh;
      overflow-y: auto;
      padding: 0.5rem;
      scrollbar-width: thin;
      scrollbar-color: #a0a0a0 #f1f5f9;
    }
    .text-lightbox-card .message::-webkit-scrollbar {
      width: 8px;
    }
    .text-lightbox-card .message::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 4px;
    }
    .text-lightbox-card .message::-webkit-scrollbar-thumb {
      background: #a0a0a0;
      border-radius: 4px;
    }
    .text-lightbox-card .divider {
      width: 100%;
      height: 1px;
      background: #e2e8f0;
      margin: 1.5rem 0;
    }
    .text-lightbox-card .nav-buttons {
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      margin-top: 1.5rem;
    }
    .text-lightbox-card .nav-button {
      font-size: 1.5rem;
      color: #3b82f6;
      cursor: pointer;
      transition: color 0.2s ease;
      border: none;
      background: transparent;
      padding: 0;
      outline: none;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .text-lightbox-card .nav-button:hover {
      background: rgba(59, 130, 246, 0.1);
      color: #1d4ed8;
    }
    .text-lightbox-card .nav-button:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }
    .text-lightbox-card .close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      background: rgba(0, 0, 0, 0.5);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }
    .text-lightbox-card .close:hover {
      background: rgba(0, 0, 0, 0.7);
      transform: scale(1.1);
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    /* --- NOVO: Estilo para a imagem de fundo do lightbox de texto --- */
    .text-lightbox-bg {
      background: white;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 2000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }
    .text-lightbox-bg.show {
      display: flex;
    }
    /* --- NOVA CLASSE PARA DESABILITAR SETAS --- */
    .nav-button.disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }
    /* --- NOVO: Estilo para o botão de compartilhamento --- */
    .share-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(255, 255, 255, 0.9);
      color: #1e293b;
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      z-index: 15;
      transition: all 0.2s ease;
      font-size: 1rem;
    }
    .share-btn:hover {
      background: rgba(255, 255, 255, 1);
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    /* --- REMOVIDO: Estilo para o aviso de offline --- */
    /*
    .offline-warning {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.95);
      color: #1e293b;
      padding: 12px 20px;
      border-radius: 1.5rem;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      z-index: 1001;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 0.9rem;
      font-weight: 500;
      max-width: 90%;
      animation: slideDown 0.3s ease-out;
    }
    @keyframes slideDown {
      from { transform: translateX(-50%) translateY(-20px); opacity: 0; }
      to { transform: translateX(-50%) translateY(0); opacity: 1; }
    }
    .offline-warning a {
      color: #1e3a8a;
      font-weight: 600;
      text-decoration: underline;
    }
    .offline-warning a:hover {
      color: #1e3a8a;
    }
    */
    /* --- REMOVIDO: Estilo para o overlay de salvamento local --- */
    /*
    .local-save-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2001;
    }
    .local-save-card {
      background: white;
      border-radius: 1.5rem;
      padding: 2rem;
      width: 90%;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 12px 30px rgba(0,0,0,0.3);
    }
    .local-save-card h3 {
      color: #1e293b;
      margin-bottom: 1rem;
    }
    .local-save-card p {
      color: #64748b;
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }
    .local-save-card .btn-group {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }
    .local-save-card button {
      padding: 0.75rem 1.5rem;
      border-radius: 1.5rem;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .local-save-card .btn-primary {
      background: var(--primary-gradient);
      color: white;
    }
    .local-save-card .btn-secondary {
      background: #e2e8f0;
      color: #1e293b;
    }
    .local-save-card .btn-secondary:hover {
      background: #cbd5e1;
    }
    */
    /* --- NOVO: Estilo para o contador de conteúdos --- */
    #contentCounter {
      margin-top: 1.5rem;
      font-size: 0.9rem;
      color: #475569;
      font-weight: 500;
    }
    /* --- NOVO: Estilo para o botão de navegação --- */
    #navigationModeBtn.active {
      background: var(--secondary-gradient);
      color: white;
    }
    /* =========================================== */
    /* 🔥 NOVOS ESTILOS PARA O EFEITO LIQUID GLASS E CURTIDAS */
    /* =========================================== */
    /* Efeito Liquid Glass - Aplicado aos cards da galeria */
    .liquid-glass-effect {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 32px rgba(31, 41, 55, 0.1);
      border-radius: 1rem;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    .liquid-glass-effect::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
    }
    .liquid-glass-effect:hover {
      background: rgba(255, 255, 255, 0.3);
      box-shadow: 0 12px 40px rgba(31, 41, 55, 0.15);
      transform: translateY(-2px);
    }
    .liquid-glass-effect:hover::before {
      opacity: 0.3;
    }
    /* Container para os controles de curtida e data - AGORA APENAS NO LIGHTBOX */
    .lightbox-controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      padding: 12px 20px;
      border-radius: 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      min-width: 300px;
      max-width: 80%;
      transition: all 0.3s ease;
    }
    /* Estilo do botão de curtir - AGORA APENAS NO LIGHTBOX */
    .lightbox-like-button {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: transparent;
      border: none;
      color: white;
      font-size: 1rem;
      cursor: pointer;
      padding: 8px 16px;
      border-radius: 1rem;
      transition: all 0.3s ease;
    }
    .lightbox-like-button:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    .lightbox-like-button i {
      transition: all 0.3s ease;
    }
    .lightbox-like-button.liked i {
      color: #f43f5e;
      transform: scale(1.2);
      text-shadow: 0 0 8px rgba(244, 63, 94, 0.7);
    }
    /* Estilo da data de postagem - AGORA APENAS NO LIGHTBOX */
    .lightbox-post-date {
      color: rgba(255, 255, 255, 0.9);
      font-size: 0.9rem;
      font-weight: 500;
      padding: 8px 16px;
      border-radius: 1rem;
    }
    /* Animação de coração batendo ao curtir */
    @keyframes heartbeat {
      0% { transform: scale(1); }
      25% { transform: scale(1.3); }
      50% { transform: scale(1); }
      75% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    .lightbox-like-button.liked i.pulse {
      animation: heartbeat 0.6s ease;
    }
    /* Estilo para o contador de curtidas - AGORA APENAS NO LIGHTBOX */
    .lightbox-like-count {
      font-size: 1rem;
      margin-left: 0.3rem;
      font-weight: 600;
    }
    /* Estilo para o card de texto com efeito liquid glass */
    .text-message-preview {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    .text-message-preview:hover {
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
    }
    /* Adicionando o efeito liquid glass aos cards de texto */
    .text-message-preview::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
      z-index: 0;
    }
    .text-message-preview:hover::before {
      opacity: 0.2;
    }
    .text-message-preview .name,
    .text-message-preview .message {
      position: relative;
      z-index: 1;
    }
    /* Estilo para o container de controles em cards de texto - AGORA APENAS NO LIGHTBOX */
    .text-lightbox-controls {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 20px;
      background: rgba(0, 0, 0, 0.7);
      border-radius: 2rem;
      margin-top: 1rem;
    }
    /* Estilo para o botão de curtir em cards de texto - AGORA APENAS NO LIGHTBOX */
    .text-lightbox-like-button {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: transparent;
      border: none;
      color: white;
      font-size: 1rem;
      cursor: pointer;
      padding: 8px 16px;
      border-radius: 1rem;
      transition: all 0.3s ease;
    }
    .text-lightbox-like-button:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    .text-lightbox-like-button.liked {
      color: #f43f5e;
    }
    .text-lightbox-like-button.liked i {
      transform: scale(1.2);
      text-shadow: 0 0 4px rgba(244, 63, 94, 0.5);
    }
    .text-lightbox-post-date {
      color: rgba(255, 255, 255, 0.9);
      font-size: 0.9rem;
      font-weight: 500;
    }
    .text-lightbox-like-button i {
      transition: all 0.3s ease;
    }
    .text-lightbox-like-button.liked i.pulse {
      animation: heartbeat 0.6s ease;
    }
    .text-lightbox-like-count {
      font-size: 1rem;
      margin-left: 0.3rem;
      font-weight: 600;
    }
    /* --- NOVO: Estilo para o modo navegação --- */
    .navigation-mode .form-section,
    .navigation-mode .flex.gap-4.mb-8 {
      display: none !important;
    }
    .navigation-mode #photoForm,
    .navigation-mode #messageForm {
      display: none !important;
    }
    /* Estilo para garantir que o cabeçalho e galeria permaneçam visíveis */
    .navigation-mode .glass-header,
    .navigation-mode #gallery-container,
    .navigation-mode #navigationModeBtn {
      display: block !important;
    }
    /* Estilo para posicionar o botão de navegação acima da galeria */
    .navigation-mode #navigationModeBtn {
      margin-bottom: 2rem;
    }

    /* --- 🔥 NOVO: Estilo para os créditos no topo e rodapé --- */
    .site-credits {
      text-align: center;
      padding: 0.5rem 0;
      font-size: 0.8rem;
      font-weight: 500;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      backdrop-filter: blur(0);
      -webkit-backdrop-filter: blur(0);
      z-index: 10;
    }
    .site-credits a {
      color: #fbbf24;
      text-decoration: underline;
    }
    .site-credits a:hover {
      color: #fcd34d;
    }
  </style>
</head>
<body>
  <!-- 🔥 NOVO: Créditos no topo -->
  <div class="site-credits">
    <small>desenvolvido e publicado por João Elias, todos os direitos reservados</small>
  </div>

  <!-- NOVO: Wrapper para fundo fixo com imagem HTML -->
<div class="bg-wrapper" id="backgroundWrapper"></div>
  <div class="container mx-auto px-4 py-8">
    <!-- NOVO: Efeito de vidro envolvendo os textos principais -->
    <div class="glass-header">
      <h1 class="text-5xl font-bold text-slate-700 mb-2">Cápsula do Tempo</h1>
      <h2 class="text-3xl font-semibold text-rose-600 mb-2">Gabriely e João Elias</h2>
      <!-- Data - CORRIGIDO: Mesma cor das outras informações (text-gray-800) -->
      <h2 class="text-xl font-semibold mb-2 text-gray-800">
        05 de Outubro de 2025
      </h2>
      <!-- Frase -->
      <p class="text-lg md:text-xl font-medium text-gray-800 italic tracking-wide leading-relaxed max-w-2xl mx-auto">
        “Cada momento compartilhado é um tesouro guardado para sempre.”
      </p>
      <!-- 🔥 CONTADOR DE CONTEÚDOS -->
      <div id="contentCounter" class="text-center mt-6 text-sm text-gray-700 font-medium">
        <i class="fas fa-camera mr-1"></i> <span id="photoCount">0</span> fotos •
        <i class="fas fa-video mr-1"></i> <span id="videoCount">0</span> vídeos •
        <i class="fas fa-comment mr-1"></i> <span id="messageCount">0</span> mensagens
      </div>
    </div>
    <!-- Botões de Alternância (um ao lado do outro, estilo cartão) -->
    <div class="flex gap-4 mb-8">
      <button id="photoBtn" class="toggle-btn active photo flex-1" onclick="showForm('photo')">
        <i class="fas fa-camera mr-2"></i> Enviar Foto do Casamento
      </button>
      <button id="messageBtn" class="toggle-btn message flex-1" onclick="showForm('message')">
        <i class="fas fa-envelope mr-2"></i> Enviar Mensagem para o Casal
      </button>
    </div>
    <!-- 🔥 BOTÃO MODO NAVEGAÇÃO - AGORA SEMPRE VISÍVEL -->
    <button id="navigationModeBtn" class="toggle-btn glass-btn w-full mt-4 mb-8" onclick="toggleNavigationMode()">
      <i class="fas fa-eye mr-2"></i> <span id="navigationModeText">Modo Navegação</span>
    </button>
    <!-- Formulário de Envio de Foto - COM GLASS CARD -->
    <div id="photoForm" class="form-section active glass-custom p-8 mb-12 max-w-3xl mx-auto">
      <h3 class="text-2xl font-semibold text-gray-800 mb-6 text-center">Compartilhe um Momento Especial</h3>
      <!-- Instrução para excluir arquivos -->
      <div class="delete-instruction">
      </div>
      <!-- Botões de Foto/Vídeo (um ao lado do outro e quadrados) - COM GLASS BTN -->
      <div class="flex gap-4 mb-6">
        <div class="media-btn glass-btn flex-1" onclick="document.getElementById('cameraInput').click()">
          <i class="fas fa-camera"></i>
          <div>Enviar Foto</div>
          <small>clique para tirar uma foto</small>
        </div>
        <div class="media-btn glass-btn flex-1" onclick="document.getElementById('videoInput').click()">
          <i class="fas fa-video"></i>
          <div>Enviar Vídeo</div>
          <small>clique para gravar um vídeo</small>
        </div>
      </div>
      <!-- Inputs ocultos -->
      <input type="file" id="cameraInput" accept="image/*" capture="environment" class="hidden" onchange="handleFileSelect(this.files[0])" />
      <input type="file" id="videoInput" accept="video/*" capture="environment" class="hidden" onchange="handleFileSelect(this.files[0])" />
      <!-- Input para escolher da galeria - COM GLASS GALLERY BTN -->
      <div class="mb-6">
        <button class="w-full py-3 px-4 glass-btn rounded-lg" onclick="document.getElementById('galleryInput').click()">
          <i class="fas fa-images"></i> Escolher da Galeria
        </button>
        <input type="file" id="galleryInput" accept="image/*,video/*" multiple class="hidden" onchange="handleFileSelectMultiple(this.files)" />
      </div>
      <!-- Preview do arquivo selecionado -->
      <div id="filePreview" class="mb-6 hidden">
        <div class="text-center p-4 bg-gray-50 rounded-lg">
          <div id="previewContent"></div>
          <div id="fileThumbnails" class="file-thumbnails mt-2"></div>
          <div id="fileCount" class="file-count"></div>
        </div>
      </div>
      <!-- Input de nome - COM GLASS INPUT -->
      <div class="mb-6">
        <input type="text" id="guestNamePhoto" placeholder="Seu nome (opcional)" class="w-full glass-input text-gray-800" />
      </div>
      <!-- Mensagem de erro -->
      <div id="photoError" class="error-message hidden"></div>
      <!-- NOVO: Placeholder para a barra de progresso -->
      <div class="progress-wrapper-placeholder">
          <div class="progress-wrapper" id="sendMediaProgressWrapper">
            <div class="progress-bar" id="sendMediaProgress"></div>
            <div class="progress-text" id="sendMediaProgressText">0%</div>
            <div class="progress-estimate" id="sendMediaProgressEstimate">--</div>
          </div>
      </div>
      <!-- Botão de envio - COM ESTILO ORIGINAL E SEM BLUR -->
      <button id="sendMediaButton" class="send-btn w-full" onclick="sendMedia()" disabled>
        <span class="button-content" id="sendMediaButtonText"><i class="fas fa-paper-plane mr-2"></i> Enviar</span>
      </button>
    </div>
    <!-- Formulário de Envio de Mensagem - COM GLASS CARD -->
    <div id="messageForm" class="form-section glass-card p-8 mb-12 max-w-3xl mx-auto">
      <h3 class="text-2xl font-semibold text-gray-800 mb-6 text-center">Envie uma Mensagem Especial</h3>
      <!-- Mini-abas: Gravar Vídeo / Só Texto -->
      <div class="message-sub-tabs">
        <div class="message-sub-tab active" onclick="showMessageSubForm('video')">
          <i class="fas fa-video mr-1"></i> Gravar Vídeo
        </div>
        <div class="message-sub-tab" onclick="showMessageSubForm('text')">
          <i class="fas fa-comment mr-1"></i> Só Texto
        </div>
      </div>
      <!-- Sub-formulário: Gravar Vídeo -->
      <div id="messageVideoSubForm" class="message-sub-form active">
        <!-- Botões para enviar vídeo na aba de mensagem (um ao lado do outro) - COM GLASS BTN -->
        <div class="flex gap-4 mb-6">
          <div class="media-btn glass-btn" onclick="document.getElementById('messageVideoInput').click()">
            <i class="fas fa-video"></i>
            <div>Gravar Vídeo</div>
            <small>Gravar um vídeo</small>
          </div>
          <div class="media-btn glass-btn" onclick="document.getElementById('messageGalleryInput').click()">
            <i class="fas fa-folder-open"></i>
            <div>Escolher da Galeria</div>
            <small>Escolher vídeo da galeria</small>
          </div>
        </div>
        <!-- Inputs ocultos para vídeos na aba de mensagem -->
        <!-- CORRIGÃO: Adicionado capture="environment" para abrir câmera diretamente -->
        <input type="file" id="messageVideoInput" accept="video/*" capture="environment" class="hidden" onchange="handleMessageVideoSelect(this.files[0])" />
        <input type="file" id="messageGalleryInput" accept="video/*" multiple class="hidden" onchange="handleMessageVideoSelectMultiple(this.files)" />
        <!-- Preview de vídeo na aba de mensagem -->
        <div id="messageVideoPreview" class="mb-6 hidden">
          <div class="text-center p-4 bg-gray-50 rounded-lg">
            <div id="messageVideoContent"></div>
            <div id="messageVideoThumbnails" class="file-thumbnails mt-2"></div>
            <div id="messageVideoCount" class="file-count"></div>
          </div>
        </div>
        <!-- Inputs de texto - COM GLASS INPUT -->
        <div class="mb-6">
          <input type="text" id="messageName" placeholder="Seu nome (opcional)" class="w-full glass-input text-gray-800" />
        </div>
        <!-- Mensagem de erro -->
        <div id="messageError" class="error-message hidden"></div>
        <!-- NOVO: Placeholder para a barra de progresso -->
        <div class="progress-wrapper-placeholder">
            <div class="progress-wrapper" id="sendMessageProgressWrapper">
              <div class="progress-bar" id="sendMessageProgress"></div>
              <div class="progress-text" id="sendMessageProgressText">0%</div>
              <div class="progress-estimate" id="sendMessageProgressEstimate">--</div>
            </div>
        </div>
        <!-- Botão de envio - COM ESTILO ORIGINAL -->
        <button id="sendMessageButton" class="send-btn w-full" onclick="sendMessage()">
          <span class="button-content" id="sendMessageButtonText"><i class="fas fa-heart mr-2"></i> Enviar Mensagem</span>
        </button>
      </div>
      <!-- Sub-formulário: Só Texto -->
      <div id="messageTextSubForm" class="message-sub-form">
        <div class="mb-4">
          <input type="text" id="textMessageName" placeholder="Seu nome (opcional)" class="w-full glass-input text-gray-800" />
        </div>
        <div class="mb-6">
          <!-- 🔥 PLACEHOLDER MELHORADO -->
          <textarea id="textMessageText" placeholder="Escreva aqui sua mensagem especial para Gabriely e João Elias... ❤️" class="w-full glass-input text-gray-800 h-40" required></textarea>
        </div>
        <div id="textMessageError" class="error-message hidden"></div>
        <div class="progress-wrapper-placeholder">
            <div class="progress-wrapper" id="sendTextMessageProgressWrapper">
              <div class="progress-bar" id="sendTextMessageProgress"></div>
              <div class="progress-text" id="sendTextMessageProgressText">0%</div>
              <div class="progress-estimate" id="sendTextMessageProgressEstimate">--</div>
            </div>
        </div>
        <button id="sendTextMessageButton" class="send-btn w-full" onclick="sendTextMessage()">
          <span class="button-content" id="sendTextMessageButtonText"><i class="fas fa-paper-plane mr-2"></i> Enviar Mensagem de Texto</span>
        </button>
      </div>
    </div>
    <!-- Seção da Galeria - COM GLASS CARD -->
    <div id="gallery-container" class="glass-custom p-8">
      <h3 class="text-3xl font-semibold text-gray-800 mb-6 text-center">✨ Galeria de Momentos Especiais</h3>
      <!-- Abas de filtro - COM LÓGICA CONDICIONAL PARA O BOTÃO "SÓ TEXTTO" -->
      <div class="filter-tabs" id="galleryFilterTabs">
        <div class="filter-tab active" data-filter="photos" onclick="filterGalleryAndSwitch('casamento')">
          Fotos do Casamento
        </div>
        <div class="filter-tab" data-filter="messages" onclick="filterGalleryAndSwitch('mensagem')">
          Mensagens para o Casal
        </div>
        <!-- O botão "Só Texto" será adicionado/ocultado dinamicamente via JavaScript -->
      </div>
      <div id="gallery">
        <div id="loadingMessage">Carregando galeria...</div>
      </div>
      <!-- Botão "Ver Mais" -->
      <button id="viewMoreBtn" class="view-more-btn" onclick="showAllItems()">
        <i class="fas fa-eye mr-2"></i> Ver Mais
      </button>
    </div>
  </div>

  <!-- 🔥 NOVO: Créditos no final -->
  <div class="site-credits">
    <small>desenvolvido e publicado por João Elias, todos os direitos reservados</small>
  </div>

  <div id="successPopup" class="success-popup hidden">
    <i class="fas fa-heart text-2xl mb-2"></i>
    <h3 class="text-xl font-bold mb-1">Obrigado!</h3>
    <p>Sua contribuição já está registrada. ❤️</p>
  </div>

  <div id="lightboxOverlay">
    <span class="close-lightbox" onclick="closeLightbox()">&times;</span>
    <span class="navButton" id="prevBtn">&#10094;</span>
    <div id="lightboxContent">
      <img id="lightboxImage" />
      <video id="lightboxVideo" controls class="hidden"></video>
      <!-- 🔥 CONTROLES DE CURTIDA E DATA AGORA NO LIGHTBOX -->
      <div class="lightbox-controls" id="lightboxControls">
        <!-- 🔥 REMOVIDO: Botão de like -->
        <!-- <button class="lightbox-like-button" id="lightboxLikeButton">
          <i class="far fa-heart"></i>
          <span class="lightbox-like-count">0</span>
        </button> -->
        <div class="lightbox-post-date" id="lightboxPostDate"></div>
      </div>
    </div>
    <span class="navButton" id="nextBtn">&#10095;</span>
    <div id="lightboxCaption"></div>
  </div>

  <!-- =========================================== -->
  <!-- 🔥 NOVO SISTEMA DE TEXTO EM TELA CHEIA (REFATORADO DO ZERO) -->
  <!-- =========================================== -->
  <div id="text-lightbox-bg" class="text-lightbox-modal hidden">
    <div class="text-lightbox-card">
      <span class="close" onclick="closeTextLightbox()">&times;</span>
      <div class="name" id="text-lightbox-name"></div>
      <div class="message" id="text-lightbox-message"></div>
      <!-- 🔥 CONTROLES DE CURTIDA E DATA PARA MENSAGENS DE TEXTO -->
      <div class="text-lightbox-controls">
        <!-- 🔥 REMOVIDO: Botão de like -->
        <!-- <button class="text-lightbox-like-button" id="textLightboxLikeButton">
          <i class="far fa-heart"></i>
          <span class="text-lightbox-like-count">0</span>
        </button> -->
        <div class="text-lightbox-post-date" id="textLightboxPostDate"></div>
      </div>
      <div class="divider"></div>
      <div class="nav-buttons">
        <button class="nav-button" id="text-prev-btn" onclick="navigateTextLightbox('prev')" disabled>
          <i class="fas fa-chevron-left"></i>
        </button>
        <button class="nav-button" id="text-next-btn" onclick="navigateTextLightbox('next')" disabled>
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- 🔥 REMOVIDO: Overlay de aviso offline -->
  <!--
  <div id="offlineWarning" class="offline-warning hidden">
    <i class="fas fa-exclamation-triangle"></i>
    Demorando muito? Não tem problema,
    <a href="#" id="saveLocallyLink">clique aqui</a> para salvar seu vídeo localmente.
  </div>
  -->

  <!-- 🔥 REMOVIDO: Overlay para salvar localmente -->
  <!--
  <div id="localSaveOverlay" class="local-save-overlay hidden">
    <div class="local-save-card">
      <h3>Salvar Vídeo Localmente</h3>
      <p>Seu vídeo será salvo no seu dispositivo e enviado automaticamente quando sua conexão melhorar.</p>
      <div class="btn-group">
        <button class="btn-primary" id="confirmLocalSave">Salvar Agora</button>
        <button class="btn-secondary" id="cancelLocalSave">Cancelar</button>
      </div>
    </div>
  </div>
  -->

  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
  <script>
    // CONFIGURAÇÕES DO CLOUDINARY (agora usado para tudo)
    const CLOUDINARY_CLOUD_NAME = "dn7no2ayc";
    const CLOUDINARY_UPLOAD_PRESET = "capsula-tempo";
    const firebaseConfig = {
      apiKey: "AIzaSyBWnPok4p37GnTI1JnSpLuaTqPEf92Ime0",
      authDomain: "capsula-do-tempo-3612d.firebaseapp.com",
      databaseURL: "https://capsula-do-tempo-3612d-default-rtdb.firebaseio.com",
      projectId: "capsula-do-tempo-3612d",
      storageBucket: "capsula-do-tempo-3612d.firebasestorage.app",
      messagingSenderId: "342686664227",
      appId: "1:342686664227:web:c4487263710ea5b5935396",
      measurementId: "G-PDV599LDP1"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const gallery = document.getElementById("gallery");
    const sendMediaButton = document.getElementById("sendMediaButton");
    const sendMediaButtonText = document.getElementById("sendMediaButtonText");
    const sendMediaProgress = document.getElementById("sendMediaProgress");
    const sendMediaProgressText = document.getElementById("sendMediaProgressText");
    const sendMediaProgressEstimate = document.getElementById("sendMediaProgressEstimate");
    const sendMessageButton = document.getElementById("sendMessageButton");
    const sendMessageButtonText = document.getElementById("sendMessageButtonText");
    const sendMessageProgress = document.getElementById("sendMessageProgress");
    const sendMessageProgressText = document.getElementById("sendMessageProgressText");
    const sendMessageProgressEstimate = document.getElementById("sendMessageProgressEstimate");
    const sendTextMessageButton = document.getElementById("sendTextMessageButton");
    const sendTextMessageButtonText = document.getElementById("sendTextMessageButtonText");
    const sendTextMessageProgress = document.getElementById("sendTextMessageProgress");
    const sendTextMessageProgressText = document.getElementById("sendTextMessageProgressText");
    const sendTextMessageProgressEstimate = document.getElementById("sendTextMessageProgressEstimate");
    const loadingMessage = document.getElementById("loadingMessage");
    const viewMoreBtn = document.getElementById("viewMoreBtn");
    const galleryFilterTabs = document.getElementById("galleryFilterTabs");
    let selectedFiles = [];
    let selectedMessageVideos = [];
    let casamentoPhotos = [];     // Apenas fotos de casamento
    let mensagemVideos = [];      // Apenas vídeos de mensagem
    let textMessages = [];        // Apenas mensagens de texto
    let currentPhotoIndex = 0;
    let currentMessageIndex = 0;
    let currentTextIndex = -1;    // 🔥 NOVO: ÍNDICE ATUAL NA LISTA DE MENSAGENS DE TEXTO
    let currentFilter = 'casamento';
    let currentForm = 'photo';
    let currentMessageSubForm = 'video';
    let visibleItemCount = 0;
    let totalItemCount = 0;
    let ITEMS_PER_PAGE = 4;
    // 🔥 NOVA VARIÁVEL: ID DO DISPOSITIVO (único por celular/navegador)
    let deviceId = localStorage.getItem('deviceId');
    if (!deviceId) {
      deviceId = generateUUID();
      localStorage.setItem('deviceId', deviceId);
    }
    function generateUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        const r = Math.random() * 16 | 0;
        const v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }
    // 🔥 REMOVIDO: Variáveis e funções de offline
    // const OFFLINE_QUEUE_KEY = "offlineVideoQueue";
    // let offlineVideoQueue = JSON.parse(localStorage.getItem(OFFLINE_QUEUE_KEY)) || [];
    // function isOnline() { return navigator.onLine; }
    // window.addEventListener('online', () => { console.log("Conexão restaurada."); });
    // window.addEventListener('offline', () => { console.log("Conexão perdida."); });

    // Carregar a imagem de fundo imediatamente
    document.addEventListener('DOMContentLoaded', () => {
      const bgWrapper = document.getElementById('backgroundWrapper');
      const bgImage = new Image();
      bgImage.src = 'CasamentoJ&G.jpeg';
      bgImage.onload = () => {
        bgWrapper.classList.add('loaded');
      };
      bgImage.onerror = () => {
        console.warn("Imagem de fundo não encontrada, usando cor sólida");
        bgWrapper.style.backgroundImage = 'linear-gradient(135deg, #1e3a8a 0%, #f43f5e 100%)';
        bgWrapper.classList.add('loaded');
      };

      // Iniciar a galeria
      setupRealtimeGallery();
      setTimeout(() => {
        filterGallery('casamento');
      }, 1000);

      // Configurar os eventos dos botões de navegação
      const btnGravarVideo = document.querySelector('.message-sub-tabs .message-sub-tab:nth-child(1)');
      const btnSoTextoForm = document.querySelector('.message-sub-tabs .message-sub-tab:nth-child(2)');
      if (btnGravarVideo) {
          btnGravarVideo.addEventListener('click', function() {
              const btnMensagensCasal = document.querySelector('.filter-tab[data-filter="messages"]');
              if (btnMensagensCasal) {
                  btnMensagensCasal.click();
              }
          });
      }
      if (btnSoTextoForm) {
          btnSoTextoForm.addEventListener('click', function() {
              setTimeout(() => {
                  const btnSoTextoGaleria = document.querySelector('.filter-tab[data-filter="text_only"]');
                  if (btnSoTextoGaleria) {
                      btnSoTextoGaleria.click();
                  }
              }, 100);
          });
      }
      const btnEnviarFoto = document.getElementById('photoBtn');
      const btnFotosGaleria = document.querySelector('.filter-tab[data-filter="photos"]');
      const btnEnviarMensagem = document.getElementById('messageBtn');
      const btnMensagensGaleria = document.querySelector('.filter-tab[data-filter="messages"]');
      if (btnEnviarFoto && btnFotosGaleria) {
          btnEnviarFoto.addEventListener('click', function() {
              btnFotosGaleria.click();
          });
          btnFotosGaleria.addEventListener('click', function() {
              btnEnviarFoto.click();
          });
      }
      if (btnEnviarMensagem && btnMensagensGaleria) {
          btnEnviarMensagem.addEventListener('click', function() {
              btnMensagensGaleria.click();
          });
          btnMensagensGaleria.addEventListener('click', function() {
              btnEnviarMensagem.click();
          });
      }

      // 🔥 REMOVIDO: Configuração de link de salvar localmente
      // document.getElementById('saveLocallyLink').addEventListener('click', (e) => { e.preventDefault(); });

      // Ativar botão de texto se houver conteúdo no textarea
      document.getElementById('textMessageText').addEventListener('input', function() {
        const text = this.value.trim();
        if (text.length > 0) {
          sendTextMessageButton.classList.add('enabled');
          sendTextMessageButton.disabled = false;
        } else {
          sendTextMessageButton.classList.remove('enabled');
          sendTextMessageButton.disabled = true;
          sendTextMessageButton.style.background = '#1e293b';
          sendTextMessageButton.style.boxShadow = '0 4px 6px rgba(30, 58, 138, 0.2)';
        }
      });
    });
    function showForm(formType) {
      currentForm = formType;
      const clickedBtn = formType === 'photo' ? document.getElementById('photoBtn') : document.getElementById('messageBtn');
      clickedBtn.classList.add('bounce');
      setTimeout(() => {
        clickedBtn.classList.remove('bounce');
      }, 500);
      document.getElementById('photoBtn').classList.toggle('active', formType === 'photo');
      document.getElementById('messageBtn').classList.toggle('active', formType === 'message');
      document.getElementById('photoForm').classList.toggle('active', formType === 'photo');
      document.getElementById('messageForm').classList.toggle('active', formType === 'message');
      updateGalleryTabs();
      if (formType === 'photo') {
        filterGallery('casamento');
      } else {
        filterGallery(currentFilter);
      }
    }
    function updateGalleryTabs() {
      const textOnlyTab = document.querySelector('.filter-tab[data-filter="text_only"]');
      if (textOnlyTab) {
        textOnlyTab.remove();
      }
      if (currentForm === 'message') {
        const textOnlyButton = document.createElement('div');
        textOnlyButton.className = 'filter-tab';
        textOnlyButton.dataset.filter = 'text_only';
        textOnlyButton.textContent = 'Só Texto';
        textOnlyButton.onclick = function() {
          filterGalleryAndSwitch('text_only');
        };
        // 🔥 INSERE O BOTÃO "MEUS ENVIOS" ANTES DO "SÓ TEXTO"
        const meusEnviosTab = document.querySelector('.filter-tab[data-filter="meus_envios"]');
        if (meusEnviosTab) {
          galleryFilterTabs.insertBefore(textOnlyButton, meusEnviosTab);
        } else {
          galleryFilterTabs.appendChild(textOnlyButton);
        }
        if (currentFilter === 'text_only') {
          textOnlyButton.classList.add('active');
        }
      }
    }
    function filterGalleryAndSwitch(filterType) {
      if (filterType === 'casamento') {
        showForm('photo');
      } else {
        showForm('message');
        if (filterType === 'text_only') {
          showMessageSubForm('text');
        }
      }
      filterGallery(filterType);
    }
    function filterGallery(filter) {
        currentFilter = filter;
        document.querySelectorAll('.filter-tab').forEach(tab => {
            const isActive = (filter === 'casamento' && tab.dataset.filter === 'photos') ||
                             (filter === 'mensagem' && tab.dataset.filter === 'messages') ||
                             (filter === 'text_only' && tab.dataset.filter === 'text_only') ||
                             (filter === 'meus_envios' && tab.dataset.filter === 'meus_envios');
            tab.classList.toggle('active', isActive);
        });
        const mediaContainers = document.querySelectorAll('#gallery .media-container');
        visibleItemCount = 0;
        totalItemCount = 0;
        mediaContainers.forEach(container => {
            const itemCategoria = container.dataset.categoria;
            const itemType = container.dataset.type;
            const itemDeviceId = container.dataset.deviceid || '';
            let shouldShow = false;
            if (filter === 'casamento' && itemCategoria === 'casamento') {
                shouldShow = true;
            } else if (filter === 'mensagem' && itemCategoria === 'mensagem' && itemType !== 'text_message') {
                shouldShow = true;
            } else if (filter === 'text_only' && itemType === 'text_message') {
                shouldShow = true;
            } else if (filter === 'meus_envios' && itemDeviceId === deviceId) {
                shouldShow = true;
            }
            if (shouldShow) {
                totalItemCount++;
                if (visibleItemCount < ITEMS_PER_PAGE) {
                    container.classList.remove('hidden-item');
                    container.classList.add('visible-item');
                    container.style.display = 'block';
                    visibleItemCount++;
                } else {
                    container.classList.add('hidden-item');
                    container.classList.remove('visible-item');
                    container.style.display = 'none';
                }
            } else {
                container.style.display = 'none';
                container.classList.add('hidden-item');
                container.classList.remove('visible-item');
            }
        });
        if (totalItemCount > ITEMS_PER_PAGE) {
            viewMoreBtn.style.display = 'inline-flex';
        } else {
            viewMoreBtn.style.display = 'none';
        }
    }
    function showAllItems() {
        const mediaContainers = document.querySelectorAll('#gallery .media-container');
        let newlyVisibleCount = 0;
        let totalVisible = 0;
        mediaContainers.forEach(container => {
            if (container.classList.contains('visible-item')) {
                totalVisible++;
            }
        });
        mediaContainers.forEach(container => {
            if (newlyVisibleCount < 4 &&
                container.classList.contains('hidden-item')) {
                const itemCategoria = container.dataset.categoria;
                const itemType = container.dataset.type;
                const itemDeviceId = container.dataset.deviceid || '';
                let belongsToFilter = false;
                if (currentFilter === 'casamento' && itemCategoria === 'casamento') {
                    belongsToFilter = true;
                } else if (currentFilter === 'mensagem' && itemCategoria === 'mensagem' && itemType !== 'text_message') {
                    belongsToFilter = true;
                } else if (currentFilter === 'text_only' && itemType === 'text_message') {
                    belongsToFilter = true;
                } else if (currentFilter === 'meus_envios' && itemDeviceId === deviceId) {
                    belongsToFilter = true;
                }
                if (belongsToFilter) {
                    container.classList.remove('hidden-item');
                    container.classList.add('visible-item');
                    container.style.display = 'block';
                    newlyVisibleCount++;
                }
            }
        });
        totalVisible += newlyVisibleCount;
        if (totalVisible >= totalItemCount) {
            viewMoreBtn.style.display = 'none';
        }
    }
    function showMessageSubForm(subFormType) {
      currentMessageSubForm = subFormType;
      document.querySelectorAll('.message-sub-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      if (subFormType === 'video') {
        document.getElementById('messageVideoSubForm').classList.add('active');
        document.getElementById('messageTextSubForm').classList.remove('active');
        document.querySelector('.message-sub-tab:nth-child(1)').classList.add('active');
      } else {
        document.getElementById('messageVideoSubForm').classList.remove('active');
        document.getElementById('messageTextSubForm').classList.add('active');
        document.querySelector('.message-sub-tab:nth-child(2)').classList.add('active');
      }
    }
    function showPopup() {
      const popup = document.getElementById("successPopup");
      popup.classList.remove("hidden");
      setTimeout(() => popup.classList.add("hidden"), 3000);
    }
    function closeLightbox() {
      document.getElementById("lightboxOverlay").style.display = "none";
      document.body.style.overflow = "";
      const video = document.getElementById("lightboxVideo");
      video.pause();
      video.removeAttribute('src');
      video.load();
    }
    function showError(elementId, message) {
      const errorElement = document.getElementById(elementId);
      errorElement.textContent = message;
      errorElement.classList.remove('hidden');
      setTimeout(() => {
        errorElement.classList.add('hidden');
      }, 5000);
    }
    function resizeImageForUpload(file, maxWidth = 1920, maxHeight = 1920, qualityStart = 0.92, qualityStep = 0.05, minQuality = 0.70) {
        if (file.size < 1 * 1024 * 1024) {
            console.log("Arquivo menor que 1MB, enviando original.");
            return Promise.resolve(file);
        }
        return new Promise((resolve, reject) => {
            if (!file.type.startsWith('image/')) {
                console.warn("Arquivo não é uma imagem, retornando arquivo original.");
                resolve(file);
                return;
            }
            const img = new Image();
            const objectUrl = URL.createObjectURL(file);
            img.onload = () => {
                URL.revokeObjectURL(objectUrl);
                let { width, height } = img;
                if (width > height) {
                    if (width > maxWidth) {
                        height = Math.round((height * maxWidth) / width);
                        width = maxWidth;
                    }
                } else {
                    if (height > maxHeight) {
                        width = Math.round((width * maxHeight) / height);
                        height = maxHeight;
                    }
                }
                if (width === img.width && height === img.height) {
                    console.log("Imagem já está dentro dos limites, retornando original.");
                    resolve(file);
                    return;
                }
                const canvas = document.createElement('canvas');
                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');
                if (!ctx) {
                    console.error("Não foi possível obter o contexto 2D do canvas.");
                    reject(new Error("Falha ao criar contexto 2D para redimensionamento."));
                    return;
                }
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';
                ctx.drawImage(img, 0, 0, width, height);
                const tryQuality = (quality) => {
                    canvas.toBlob((blob) => {
                        if (blob) {
                            const resizedFile = new File([blob], file.name, {
                                type: 'image/jpeg',
                                lastModified: Date.now()
                            });
                            console.log(`Tentativa de qualidade ${quality}: ${resizedFile.size} bytes`);
                            if (resizedFile.size < 5 * 1024 * 1024 || quality <= minQuality) {
                                console.log(`Imagem redimensionada de ${img.width}x${img.height} para ${width}x${height}. Tamanho original: ${(file.size / 1024 / 1024).toFixed(2)}MB, Novo tamanho: ${(resizedFile.size / 1024 / 1024).toFixed(2)}MB com qualidade ${quality}`);
                                resolve(resizedFile);
                            } else {
                                const nextQuality = quality - qualityStep;
                                if (nextQuality >= minQuality) {
                                    tryQuality(nextQuality);
                                } else {
                                    console.warn("Mesmo com qualidade mínima, arquivo é muito grande. Enviando original.");
                                    resolve(file);
                                }
                            }
                        } else {
                            console.error("Falha ao converter canvas para blob.");
                            reject(new Error("Falha ao converter imagem redimensionada."));
                        }
                    }, 'image/jpeg', quality);
                };
                tryQuality(qualityStart);
            };
            img.onerror = (err) => {
                URL.revokeObjectURL(objectUrl);
                console.error("Erro ao carregar imagem para redimensionamento:", err);
                reject(new Error("Falha ao carregar imagem para redimensionamento."));
            };
            img.src = objectUrl;
        });
    }
    function handleFileSelect(file) {
      if (!file) return;
      selectedFiles.push(file);
      updateFilePreview();
    }
    function handleFileSelectMultiple(files) {
      for (let file of files) {
        if (!selectedFiles.some(f => f.name === file.name && f.size === file.size)) {
          selectedFiles.push(file);
        }
      }
      updateFilePreview();
    }
    function handleMessageVideoSelect(file) {
      if (!file) return;
      if (!file.type.startsWith('video/')) {
        showError('messageError', 'Por favor, selecione um arquivo de vídeo.');
        return;
      }
      selectedMessageVideos.push(file);
      updateMessageVideoPreview();
    }
    function handleMessageVideoSelectMultiple(files) {
      for (let file of files) {
        if (!selectedMessageVideos.some(f => f.name === file.name && f.size === file.size)) {
          selectedMessageVideos.push(file);
        }
      }
      updateMessageVideoPreview();
    }
    function updateFilePreview() {
      const filePreview = document.getElementById('filePreview');
      const previewContent = document.getElementById('previewContent');
      const fileThumbnails = document.getElementById('fileThumbnails');
      const fileCount = document.getElementById('fileCount');
      const errorElement = document.getElementById('photoError');
      errorElement.classList.add('hidden');
      previewContent.innerHTML = '';
      fileThumbnails.innerHTML = '';
      selectedFiles.forEach((file, index) => {
        const thumbnailContainer = document.createElement('div');
        thumbnailContainer.className = 'file-thumbnail';
        if (file.type.startsWith('image/')) {
          const img = document.createElement('img');
          const thumbUrl = URL.createObjectURL(file);
          img.src = thumbUrl;
          img.onload = () => URL.revokeObjectURL(thumbUrl);
          thumbnailContainer.appendChild(img);
        } else if (file.type.startsWith('video/')) {
            thumbnailContainer.classList.add('video-thumbnail-preview');
            const video = document.createElement('video');
            video.muted = true;
            video.playsInline = true;
            const source = document.createElement('source');
            const thumbUrl = URL.createObjectURL(file);
            source.src = thumbUrl;
            source.type = file.type;
            video.appendChild(source);
            video.onloadeddata = () => {
                 URL.revokeObjectURL(thumbUrl);
                 try {
                     const canvas = document.createElement('canvas');
                     canvas.width = video.videoWidth / 4;
                     canvas.height = video.videoHeight / 4;
                     const ctx = canvas.getContext('2d');
                     ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                     const dataURL = canvas.toDataURL('image/jpeg');
                     const img = document.createElement('img');
                     img.src = dataURL;
                     thumbnailContainer.innerHTML = '';
                     thumbnailContainer.appendChild(img);
                 } catch (e) {
                     console.warn("Não foi possível gerar miniatura do vídeo para prévia:", e);
                 }
            };
            thumbnailContainer.appendChild(video);
        }
        const removeBtn = document.createElement('span');
        removeBtn.className = 'remove-btn';
        removeBtn.innerHTML = '&times;';
        removeBtn.onclick = (e) => {
          e.stopPropagation();
          thumbnailContainer.remove();
          selectedFiles.splice(index, 1);
          updateFilePreview();
        };
        thumbnailContainer.appendChild(removeBtn);
        fileThumbnails.appendChild(thumbnailContainer);
      });
      if (selectedFiles.length === 0) {
        filePreview.classList.add('hidden');
        sendMediaButton.disabled = true;
        sendMediaButton.classList.remove('enabled'); // Remove o gradiente
        sendMediaButton.style.background = '#1e293b'; // Fundo escuro padrão
        sendMediaButton.style.boxShadow = '0 4px 6px rgba(30, 58, 138, 0.2)';
      } else {
        fileCount.textContent = selectedFiles.length === 1 ? '1 arquivo selecionado' : `${selectedFiles.length} arquivos selecionados`;
        filePreview.classList.remove('hidden');
        sendMediaButton.disabled = false;
        sendMediaButton.classList.add('enabled'); // Aplica o gradiente vibrante
      }
    }
    function updateMessageVideoPreview() {
      const videoPreview = document.getElementById('messageVideoPreview');
      const videoContent = document.getElementById('messageVideoContent');
      const videoThumbnails = document.getElementById('messageVideoThumbnails');
      const videoCount = document.getElementById('messageVideoCount');
      const errorElement = document.getElementById('messageError');
      errorElement.classList.add('hidden');
      videoContent.innerHTML = '';
      videoThumbnails.innerHTML = '';
      selectedMessageVideos.forEach((file, index) => {
        const thumbnailContainer = document.createElement('div');
        thumbnailContainer.className = 'file-thumbnail';
        if (file.type.startsWith('video/')) {
          thumbnailContainer.classList.add('video-thumbnail-preview');
          const video = document.createElement('video');
          video.muted = true;
          video.playsInline = true;
          const source = document.createElement('source');
          const thumbUrl = URL.createObjectURL(file);
          source.src = thumbUrl;
          source.type = file.type;
          video.appendChild(source);
          video.onloadeddata = () => {
            URL.revokeObjectURL(thumbUrl);
            try {
              const canvas = document.createElement('canvas');
              canvas.width = video.videoWidth / 4;
              canvas.height = video.videoHeight / 4;
              const ctx = canvas.getContext('2d');
              ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
              const dataURL = canvas.toDataURL('image/jpeg');
              const img = document.createElement('img');
              img.src = dataURL;
              thumbnailContainer.innerHTML = '';
              thumbnailContainer.appendChild(img);
            } catch (e) {
              console.warn("Não foi possível gerar miniatura do vídeo para prévia (mensagem):", e);
            }
          };
          thumbnailContainer.appendChild(video);
        }
        const removeBtn = document.createElement('span');
        removeBtn.className = 'remove-btn';
        removeBtn.innerHTML = '&times;';
        removeBtn.onclick = (e) => {
          e.stopPropagation();
          thumbnailContainer.remove();
          selectedMessageVideos.splice(index, 1);
          updateMessageVideoPreview();
        };
        thumbnailContainer.appendChild(removeBtn);
        videoThumbnails.appendChild(thumbnailContainer);
      });
      if (selectedMessageVideos.length === 0) {
        videoPreview.classList.add('hidden');
        sendMessageButton.disabled = true;
        sendMessageButton.classList.remove('enabled'); // Remove o gradiente
        sendMessageButton.style.background = '#1e293b'; // Fundo escuro padrão
        sendMessageButton.style.boxShadow = '0 4px 6px rgba(30, 58, 138, 0.2)';
      } else {
        videoCount.textContent = selectedMessageVideos.length === 1 ? '1 vídeo selecionado' : `${selectedMessageVideos.length} vídeos selecionados`;
        videoPreview.classList.remove('hidden');
        sendMessageButton.disabled = false;
        sendMessageButton.classList.add('enabled'); // Aplica o gradiente vibrante
      }
    }
    function uploadToCloudinary(file, progressBarElement, progressTextElement, progressEstimateElement, isVideo = false) {
      return new Promise((resolve, reject) => {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
        const xhr = new XMLHttpRequest();
        const uploadUrl = `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/upload`;
        xhr.timeout = isVideo ? 90000 : 60000;
        let startTime = Date.now();
        let lastBytes = 0;
        let speedHistory = [];
        const updateProgressEstimate = (uploadedBytes, totalSize) => {
          const elapsed = Date.now() - startTime;
          const uploadedSinceLast = uploadedBytes - lastBytes;
          lastBytes = uploadedBytes;
          if (elapsed < 2000) {
            speedHistory.push(uploadedSinceLast / (elapsed / 1000));
          }
          if (speedHistory.length > 5) speedHistory.shift();
          const avgSpeed = speedHistory.reduce((a,b) => a + b, 0) / speedHistory.length || 0;
          if (avgSpeed > 0) {
            const remainingBytes = totalSize - uploadedBytes;
            const estimatedSeconds = Math.ceil(remainingBytes / avgSpeed);
            const minutes = Math.floor(estimatedSeconds / 60);
            const seconds = estimatedSeconds % 60;
            const timeStr = minutes > 0 ? `${minutes}m ${seconds}s` : `${seconds}s`;
            progressEstimateElement.textContent = `Estimado: ${timeStr}`;
            progressEstimateElement.style.opacity = 1;
          }
        };
        xhr.upload.addEventListener('progress', (e) => {
          if (e.lengthComputable) {
            const percentComplete = Math.round((e.loaded / e.total) * 100);
            progressBarElement.style.width = percentComplete + '%';
            progressTextElement.textContent = percentComplete + '%';
            updateProgressEstimate(e.loaded, e.total);
          }
        });
        xhr.addEventListener('load', () => {
          console.log('Resposta bruta do Cloudinary:', xhr.responseText);
          if (xhr.status === 200) {
            let response;
            try {
              response = JSON.parse(xhr.responseText);
            } catch (parseError) {
              console.error('Erro ao parsear resposta JSON do Cloudinary:', parseError, xhr.responseText);
              reject(new Error(`Resposta inválida do Cloudinary: ${xhr.responseText.substring(0, 100)}...`));
              return;
            }
            if (response && response.secure_url) {
              console.log("Upload Cloudinary bem-sucedido. URL:", response.secure_url);
              resolve(response.secure_url);
            } else {
              console.error('Erro ou resposta inesperada do Cloudinary:', response);
              reject(new Error(`Cloudinary API Error: ${response.error?.message || 'Resposta inválida'}`));
            }
          } else {
            console.error('Erro no upload Cloudinary - Status:', xhr.status, 'Resposta:', xhr.responseText);
            reject(new Error(`Erro no upload Cloudinary: ${xhr.status} - ${xhr.responseText}`));
          }
        });
        xhr.addEventListener('error', () => {
          console.error('Erro de conexão Cloudinary');
          reject(new Error('Erro de conexão com Cloudinary - verifique sua internet.'));
        });
        xhr.addEventListener('timeout', () => {
          reject(new Error('Tempo de upload esgotado para Cloudinary. Tente um arquivo menor ou verifique sua conexão.'));
        });
        xhr.open('POST', uploadUrl);
        xhr.send(formData);
        console.log("Requisição POST enviada para Cloudinary.");
      });
    }
    async function sendMedia() {
      if (selectedFiles.length === 0) {
        showError('photoError', 'Nenhum arquivo selecionado.');
        return;
      }
      const name = document.getElementById('guestNamePhoto').value || 'Anônimo';
      const originalText = sendMediaButtonText.innerHTML;
      const errorElement = document.getElementById('photoError');
      errorElement.classList.add('hidden');
      sendMediaButton.disabled = true;
      sendMediaButton.classList.add('sending');
      sendMediaButtonText.innerHTML = '<span class="spinner-icon">💕</span> Enviando...';
      document.getElementById('sendMediaProgressWrapper').classList.add('visible');
      sendMediaProgress.style.width = '0%';
      sendMediaProgressText.textContent = '0%';
      sendMediaProgressEstimate.textContent = '--';
      try {
        const mediaUrls = [];
        for (let i = 0; i < selectedFiles.length; i++) {
          const file = selectedFiles[i];
          let processedFile = file;
          if (file.type.startsWith('image/')) {
              try {
                  console.log("Tentando redimensionar imagem para upload...");
                  processedFile = await resizeImageForUpload(file);
                  console.log("Imagem processada para upload:", processedFile.name, (processedFile.size / 1024 / 1024).toFixed(2) + "MB");
              } catch (resizeError) {
                  console.warn("Falha ao redimensionar imagem, enviando original:", resizeError.message);
                  processedFile = file;
              }
          }
          console.log("Iniciando upload para Cloudinary...");
          const mediaURL = await uploadToCloudinary(processedFile, sendMediaProgress, sendMediaProgressText, sendMediaProgressEstimate, file.type.startsWith('video/'));
          console.log("Upload concluído:", mediaURL);
          console.log("Salvando dados no Firebase...");
          const newEntry = database.ref('itens').push();
          await newEntry.set({
            name,
            message: '',
            url: mediaURL,
            timestamp: Date.now(),
            type: file.type.startsWith('video/') ? 'video' : 'image',
            categoria: 'casamento',
            deviceId: deviceId, // 🔥 SALVA O ID DO DISPOSITIVO
            likes: 0, // 🔥 ADICIONA CONTADOR DE CURTIDAS
            likedBy: [] // 🔥 ADICIONA ARRAY DE QUEM CURTIU
          });
          console.log("Dados salvos no Firebase com sucesso.");
          mediaUrls.push(mediaURL);
        }
        sendMediaButton.classList.remove('sending');
        sendMediaButton.classList.add('sent');
        sendMediaButtonText.innerHTML = '<i class="fas fa-check mr-2"></i> Enviado!';
        showPopup();
        showConfetti(); // 🔥 CONFETE!
        setTimeout(() => {
          sendMediaButton.classList.remove('sent');
          sendMediaButton.disabled = true;
          sendMediaButtonText.innerHTML = '<i class="fas fa-paper-plane mr-2"></i> Enviar';
          sendMediaProgress.style.width = '0%';
          sendMediaProgressText.textContent = '0%';
          sendMediaProgressEstimate.textContent = '--';
          document.getElementById('sendMediaProgressWrapper').classList.remove('visible');
          document.getElementById('filePreview').classList.add('hidden');
          const previewContent = document.getElementById('previewContent');
          const imgPreview = previewContent.querySelector('img');
          if (imgPreview && imgPreview.src && imgPreview.src.startsWith('blob:')) {
              URL.revokeObjectURL(imgPreview.src);
              imgPreview.src = '';
          }
          previewContent.innerHTML = '';
          document.getElementById('guestNamePhoto').value = '';
          selectedFiles = [];
          document.getElementById('cameraInput').value = '';
          document.getElementById('videoInput').value = '';
          document.getElementById('galleryInput').value = '';
        }, 3000);
      } catch (err) {
        console.error("Erro completo no processo de envio:", err);
        showError('photoError', `Falha no envio: ${err.message || "Erro desconhecido. Verifique o console do navegador."}`);
        sendMediaButton.classList.remove('sending');
        sendMediaButton.disabled = false;
        sendMediaButtonText.innerHTML = originalText;
        sendMediaProgress.style.width = '0%';
        sendMediaProgressText.textContent = '0%';
        sendMediaProgressEstimate.textContent = '--';
        document.getElementById('sendMediaProgressWrapper').classList.remove('visible');
      }
    }
    async function sendMessage() {
      const name = document.getElementById('messageName').value.trim() || 'Anônimo';
      const message = '';
      const originalHTML = sendMessageButtonText.innerHTML;
      const errorElement = document.getElementById('messageError');
      errorElement.classList.add('hidden');
      sendMessageButton.disabled = true;
      sendMessageButtonText.innerHTML = '<span class="spinner-icon">💌</span> Enviando...';
      document.getElementById('sendMessageProgressWrapper').classList.add('visible');
      sendMessageProgress.style.width = '0%';
      sendMessageProgressText.textContent = '0%';
      sendMessageProgressEstimate.textContent = '--';

      // 🔥 REMOVIDO: Lógica de timeout e offline
      // let timeoutTimer;
      // let isTimeout = false;
      // timeoutTimer = setTimeout(() => { ... }, 15000);

      try {
        const videoUrls = [];
        for (let i = 0; i < selectedMessageVideos.length; i++) {
          const file = selectedMessageVideos[i];
          console.log("Iniciando upload de vídeo de mensagem para Cloudinary...");

          // 🔥 REMOVIDO: Condição de offline
          // if (!isOnline() || isTimeout) {
          //   saveVideoLocally(file, name, message, 'video_message');
          //   throw new Error("Offline mode activated");
          // }

          const videoURL = await uploadToCloudinary(file, sendMessageProgress, sendMessageProgressText, sendMessageProgressEstimate, true);
          console.log("Upload de vídeo de mensagem concluído:", videoURL);
          videoUrls.push(videoURL);
        }

        // clearTimeout(timeoutTimer);

        console.log("Salvando mensagem no Firebase...");
        const newEntry = database.ref('itens').push();
        await newEntry.set({
          name,
          message: message,
          timestamp: Date.now(),
          videoURL: videoUrls.length > 0 ? videoUrls[0] : null,
          type: videoUrls.length > 0 ? 'video_message' : 'text_message',
          categoria: 'mensagem',
          deviceId: deviceId, // 🔥 SALVA O ID DO DISPOSITIVO
          likes: 0, // 🔥 ADICIONA CONTADOR DE CURTIDAS
          likedBy: [] // 🔥 ADICIONA ARRAY DE QUEM CURTIU
        });
        console.log("Mensagem salva no Firebase com sucesso.");
        sendMessageButton.classList.add('sent');
        sendMessageButtonText.innerHTML = '<i class="fas fa-check mr-2"></i> Mensagem Enviada!';
        showPopup();
        showConfetti(); // 🔥 CONFETE!
        setTimeout(() => {
          sendMessageButton.classList.remove('sent');
          sendMessageButton.disabled = false;
          sendMessageButtonText.innerHTML = '<i class="fas fa-heart mr-2"></i> Enviar Mensagem';
          sendMessageProgress.style.width = '0%';
          sendMessageProgressText.textContent = '0%';
          sendMessageProgressEstimate.textContent = '--';
          document.getElementById('sendMessageProgressWrapper').classList.remove('visible');
          document.getElementById('messageVideoPreview').classList.add('hidden');
          const messageVideoContent = document.getElementById('messageVideoContent');
          const videoPreview = messageVideoContent.querySelector('video source');
          if (videoPreview && videoPreview.src && videoPreview.src.startsWith('blob:')) {
              URL.revokeObjectURL(videoPreview.src);
              videoPreview.src = '';
          }
          messageVideoContent.innerHTML = '';
          document.getElementById('messageName').value = "";
          selectedMessageVideos = [];
          document.getElementById('messageVideoInput').value = '';
          document.getElementById('messageGalleryInput').value = '';
        }, 3000);
      } catch (err) {
        console.error("Erro completo no processo de envio de mensagem:", err);

        // 🔥 REMOVIDO: Tratamento de erro offline
        // if (err.message === "Offline mode activated") {
        //   sendMessageButton.disabled = false;
        //   sendMessageButtonText.innerHTML = originalHTML;
        //   sendMessageProgress.style.width = '0%';
        //   sendMessageProgressText.textContent = '0%';
        //   sendMessageProgressEstimate.textContent = '--';
        //   document.getElementById('sendMessageProgressWrapper').classList.remove('visible');
        // } else {

        showError('messageError', `Falha no envio: ${err.message || "Erro desconhecido. Verifique o console do navegador."}`);
        sendMessageButton.disabled = false;
        sendMessageButtonText.innerHTML = originalHTML;
        sendMessageProgress.style.width = '0%';
        sendMessageProgressText.textContent = '0%';
        sendMessageProgressEstimate.textContent = '--';
        document.getElementById('sendMessageProgressWrapper').classList.remove('visible');
        // }
      }
    }
    async function sendTextMessage() {
      const name = document.getElementById('textMessageName').value.trim() || 'Anônimo';
      const message = document.getElementById('textMessageText').value.trim();
      const originalHTML = sendTextMessageButtonText.innerHTML;
      const errorElement = document.getElementById('textMessageError');
      errorElement.classList.add('hidden');
      if (!message) {
        showError('textMessageError', 'Por favor, escreva uma mensagem.');
        return;
      }
      sendTextMessageButton.disabled = true;
      sendTextMessageButtonText.innerHTML = '<span class="spinner-icon">📝</span> Enviando...';
      document.getElementById('sendTextMessageProgressWrapper').classList.add('visible');
      sendTextMessageProgress.style.width = '0%';
      sendTextMessageProgressText.textContent = '0%';
      sendTextMessageProgressEstimate.textContent = '--';
      try {
        console.log("Salvando mensagem de texto no Firebase...");
        const newEntry = database.ref('itens').push();
        await newEntry.set({
          name,
          message: message,
          timestamp: Date.now(),
          videoURL: null,
          type: 'text_message',
          categoria: 'mensagem',
          deviceId: deviceId, // 🔥 SALVA O ID DO DISPOSITIVO
          likes: 0, // 🔥 ADICIONA CONTADOR DE CURTIDAS
          likedBy: [] // 🔥 ADICIONA ARRAY DE QUEM CURTIU
        });
        console.log("Mensagem de texto salva no Firebase com sucesso.");
        sendTextMessageButton.classList.add('sent');
        sendTextMessageButtonText.innerHTML = '<i class="fas fa-check mr-2"></i> Mensagem Enviada!';
        showPopup();
        showConfetti(); // 🔥 CONFETE!
        setTimeout(() => {
          sendTextMessageButton.classList.remove('sent');
          sendTextMessageButton.disabled = false;
          sendTextMessageButtonText.innerHTML = '<i class="fas fa-paper-plane mr-2"></i> Enviar Mensagem de Texto';
          sendTextMessageProgress.style.width = '0%';
          sendTextMessageProgressText.textContent = '0%';
          sendTextMessageProgressEstimate.textContent = '--';
          document.getElementById('sendTextMessageProgressWrapper').classList.remove('visible');
          document.getElementById('textMessageName').value = "";
          document.getElementById('textMessageText').value = "";
          sendTextMessageButton.classList.remove('enabled'); // Volta ao estado padrão após envio
        }, 3000);
      } catch (err) {
        console.error("Erro completo no processo de envio de mensagem de texto:", err);
        showError('textMessageError', `Falha no envio: ${err.message || "Erro desconhecido. Verifique o console do navegador."}`);
        sendTextMessageButton.disabled = false;
        sendTextMessageButtonText.innerHTML = originalHTML;
        sendTextMessageProgress.style.width = '0%';
        sendTextMessageProgressText.textContent = '0%';
        sendTextMessageProgressEstimate.textContent = '--';
        document.getElementById('sendTextMessageProgressWrapper').classList.remove('visible');
        sendTextMessageButton.classList.remove('enabled'); // Volta ao estado padrão
      }
    }

    // 🔥 REMOVIDO: TODO O SISTEMA DE ARMAZENAMENTO OFFLINE
    /*
    function setupOfflineSystem() { ... }
    function showOfflineWarning() { ... }
    function hideOfflineWarning() { ... }
    function showLocalSaveOverlay() { ... }
    function hideLocalSaveOverlay() { ... }
    function saveVideoLocally(file, name, message, type) { ... }
    function saveCurrentVideoLocally() { ... }
    function processOfflineQueue() { ... }
    */

    // =============================
    // 🔥 NOVO SISTEMA DE COMPARTILHAMENTO
    // =============================
    function addShareButtonToItem(container, itemData) {
      // Verifica se já existe um botão de compartilhamento
      if (container.querySelector('.share-btn')) return;
      const shareBtn = document.createElement('button');
      shareBtn.className = 'share-btn';
      shareBtn.innerHTML = '<i class="fas fa-share-alt"></i>';
      shareBtn.title = 'Compartilhar';
      // Evento de clique
      shareBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        e.preventDefault();
        // Se for mensagem de texto, usar o modal de texto
        if (itemData.type === 'text_message') {
          openTextLightbox(textMessages.findIndex(msg => msg.name === itemData.name && msg.message === itemData.message));
          return;
        }
        // Se for vídeo ou imagem, usar o lightbox padrão
        if (itemData.type === 'video' || itemData.type === 'video_message') {
          const array = itemData.type === 'video' ? casamentoPhotos : mensagemVideos;
          const index = array.findIndex(item => item.url === itemData.url);
          if (index !== -1) {
            showLightbox(index, itemData.type);
          }
        } else if (itemData.type === 'image') {
          const index = casamentoPhotos.findIndex(item => item.url === itemData.url);
          if (index !== -1) {
            showLightbox(index, 'image');
          }
        }
        // Exibir opções de compartilhamento
        showShareOptions(itemData);
      });
      container.appendChild(shareBtn);
    }
    function showShareOptions(itemData) {
      // Criar menu de opções
      const menu = document.createElement('div');
      menu.className = 'fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-white rounded-xl shadow-lg p-4 z-50 animate-fadeIn';
      menu.style.maxWidth = '90%';
      // Título
      const title = document.createElement('div');
      title.className = 'text-center font-semibold text-gray-800 mb-3';
      title.textContent = 'Compartilhar este conteúdo';
      menu.appendChild(title);
      // Botões de opções
      const options = [
        { icon: 'fab fa-facebook', label: 'Facebook', action: 'facebook' },
        { icon: 'fab fa-instagram', label: 'Instagram', action: 'instagram' },
        { icon: 'fab fa-whatsapp', label: 'WhatsApp', action: 'whatsapp' },
        { icon: 'fas fa-link', label: 'Copiar Link', action: 'copy' },
        { icon: 'fas fa-download', label: 'Baixar Arquivo', action: 'download' }
      ];
      options.forEach(option => {
        const btn = document.createElement('button');
        btn.className = 'flex items-center justify-center gap-2 w-full py-3 mb-2 rounded-lg hover:bg-gray-50 transition-colors';
        btn.innerHTML = `<i class="${option.icon}"></i> ${option.label}`;
        btn.addEventListener('click', () => {
          handleShareAction(option.action, itemData);
          menu.remove();
        });
        menu.appendChild(btn);
      });
      // Botão de fechar
      const closeBtn = document.createElement('button');
      closeBtn.className = 'w-full py-2 text-gray-500 hover:text-gray-700';
      closeBtn.textContent = 'Cancelar';
      closeBtn.addEventListener('click', () => {
        menu.remove();
      });
      menu.appendChild(closeBtn);
      document.body.appendChild(menu);
      // Animação
      setTimeout(() => {
        menu.classList.add('animate-fadeIn');
      }, 10);
    }
    function handleShareAction(action, itemData) {
      switch(action) {
        case 'facebook':
          const fbUrl = itemData.type === 'text_message'
            ? encodeURIComponent(itemData.message)
            : itemData.url;
          window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=${encodeURIComponent(itemData.name || 'Anônimo')}`, '_blank');
          break;
        case 'instagram':
          // Instagram não permite compartilhamento direto por link, então abre a imagem/vídeo
          if (itemData.type === 'text_message') {
            alert("Para compartilhar no Instagram, copie a mensagem e cole na postagem.");
          } else {
            window.open(itemData.url, '_blank');
          }
          break;
        case 'whatsapp':
          const whatsappText = itemData.type === 'text_message'
            ? itemData.message
            : `Veja esta mensagem para o casal: ${itemData.name || 'Anônimo'}
${itemData.message || ''}
${window.location.href}`;
          window.open(`https://wa.me/?text=${encodeURIComponent(whatsappText)}`, '_blank');
          break;
        case 'copy':
          navigator.clipboard.writeText(window.location.href)
            .then(() => alert("Link copiado para a área de transferência!"))
            .catch(err => alert("Falha ao copiar link: " + err));
          break;
        case 'download':
          const downloadUrl = itemData.type === 'text_message'
            ? null
            : itemData.url;
          if (downloadUrl) {
            const a = document.createElement('a');
            a.href = downloadUrl;
            a.download = itemData.type === 'video' || itemData.type === 'video_message' ? 'video.mp4' : 'foto.jpg';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
          } else {
            alert("Você pode copiar a mensagem para baixar como texto.");
          }
          break;
      }
    }
    // Função para atualizar a galeria com botões de compartilhamento
    function addItemToGallery(itemData) {
        const { name, message, url, videoURL, type, categoria, deviceId: itemDeviceId, timestamp, likes = 0 } = itemData;
        if (loadingMessage && loadingMessage.parentNode === gallery) {
            gallery.removeChild(loadingMessage);
        }
        const container = document.createElement("div");
        container.className = "media-container liquid-glass-effect"; // 🔥 ADICIONA EFEITO LIQUID GLASS
        container.dataset.categoria = categoria;
        container.dataset.type = type;
        container.dataset.deviceid = itemDeviceId || ''; // 🔥 GUARDA O ID DO DISPOSITIVO
        container.dataset.timestamp = timestamp; // 🔥 GUARDA O TIMESTAMP PARA REFERÊNCIA
        // Adiciona o botão de compartilhamento
        addShareButtonToItem(container, itemData);

        // --- 🔥 REMOVIDO: Ícone de pendência de upload ---
        /*
        if (itemData.status === 'pending') {
            const pendingBadge = document.createElement('div');
            pendingBadge.className = 'pending-upload-badge';
            pendingBadge.innerHTML = '<i class="fas fa-cloud-upload-alt"></i>';
            pendingBadge.title = 'Aguardando envio';
            container.appendChild(pendingBadge);
        }
        */

        const displayType = type;
        if (displayType === 'video') {
            container.innerHTML = `
                <div class="video-thumbnail">
                    <img src="${url}" alt="Miniatura do vídeo" loading="lazy">
                    <div class="video-overlay">
                        <i class="fas fa-play-circle"></i>
                    </div>
                </div>
                <div class="media-info text-center">
                    <div class="text-xs font-medium truncate">${name || 'Anônimo'}</div>
                </div>
            `;
            casamentoPhotos.unshift({
                name,
                message: '',
                url: url,
                type: 'video',
                videoURL: null,
                deviceId: itemDeviceId,
                timestamp: timestamp,
                likes: likes
            });
        } else if (displayType === 'video_message') {
            container.innerHTML = `
                <div class="video-thumbnail">
                    <img src="${videoURL}" alt="Miniatura do vídeo" loading="lazy">
                    <div class="video-overlay">
                        <i class="fas fa-play-circle"></i>
                    </div>
                </div>
                <div class="media-info text-center">
                    <div class="text-xs font-medium truncate">${name || 'Anônimo'}</div>
                    <div class="message-text">${message || ''}</div>
                </div>
            `;
            mensagemVideos.unshift({
                name,
                message,
                url: videoURL,
                type: 'video_message',
                videoURL: videoURL,
                deviceId: itemDeviceId,
                timestamp: timestamp,
                likes: likes
            });
        } else if (displayType === 'text_message') {
            container.innerHTML = `
                <div class="text-message-preview">
                    <div class="quote-mark">“</div>
                    <div class="name">${name || 'Anônimo'}</div>
                    <div class="message">${message || ''}</div>
                </div>
            `;
            // 🔥 ADICIONA À LISTA DE MENSAGENS DE TEXTO (ORDENADA POR RECENTE)
            textMessages.unshift({
                name,
                message,
                url: null,
                type: 'text_message',
                videoURL: null,
                deviceId: itemDeviceId,
                timestamp: timestamp,
                likes: likes
            });
            // 🔥 EVENTO DE CLIQUE NO CARD DE TEXTO
            container.addEventListener("click", () => {
                // Encontra o índice da mensagem clicada na lista ordenada (mais recente primeiro)
                const currentIndex = textMessages.findIndex(item =>
                    item.name === name && item.message === message
                );
                if (currentIndex !== -1) {
                    openTextLightbox(currentIndex);
                }
            });
        } else {
            container.innerHTML = `<img src="${url}" alt="${name || 'Foto'}" loading="lazy">`;
            casamentoPhotos.unshift({
                name,
                message: '',
                url: url,
                type: 'image',
                videoURL: null,
                deviceId: itemDeviceId,
                timestamp: timestamp,
                likes: likes
            });
        }
        gallery.insertBefore(container, gallery.firstChild);
        if (displayType === 'video' || displayType === 'video_message') {
            container.addEventListener("click", (e) => {
                e.stopPropagation();
                let targetArray = [];
                let currentIndex = 0;
                if (displayType === 'video') {
                    targetArray = casamentoPhotos;
                    currentIndex = targetArray.findIndex(p => p.url === url);
                } else if (displayType === 'video_message') {
                    targetArray = mensagemVideos;
                    currentIndex = targetArray.findIndex(p => p.url === videoURL);
                }
                if (currentIndex !== -1) {
                    if (currentFilter === 'casamento') {
                        currentPhotoIndex = currentIndex;
                    } else if (currentFilter === 'mensagem') {
                        currentMessageIndex = currentIndex;
                    }
                    showLightbox(currentIndex, displayType);
                }
            });
        } else if (displayType === 'image') {
            container.addEventListener("click", (e) => {
                e.stopPropagation();
                const currentIndex = casamentoPhotos.findIndex(p => p.url === url);
                if (currentIndex !== -1) {
                    currentPhotoIndex = currentIndex;
                    showLightbox(currentIndex, 'image');
                }
            });
        }
        filterGallery(currentFilter);
        // 🔥 ATUALIZA O CONTADOR APÓS ADICIONAR O ITEM
        updateContentCounter();
    }
    // 🔥 FUNÇÃO PARA FORMATAR DATA
    function formatDate(timestamp) {
        const date = new Date(timestamp);
        const options = {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        };
        return date.toLocaleDateString('pt-BR', options);
    }
    // 🔥 FUNÇÃO PARA TOGGLE DE CURTIDA (REMOVIDA, MAS MANTIDA COMENTADA PARA REFERÊNCIA)
    /*
    function toggleLike(button, timestamp, type) {
        // Encontra o item no array correspondente
        let item = null;
        let array = null;
        if (type === 'image' || type === 'video') {
            array = casamentoPhotos;
            item = array.find(p => p.timestamp === timestamp);
        } else if (type === 'video_message') {
            array = mensagemVideos;
            item = array.find(p => p.timestamp === timestamp);
        } else if (type === 'text_message') {
            array = textMessages;
            item = array.find(p => p.timestamp === timestamp);
        }
        if (!item) return;
        // Verifica se o usuário já curtiu
        const hasLiked = item.likedBy && item.likedBy.includes(deviceId);
        if (hasLiked) {
            // Descurtir
            item.likes = Math.max(0, item.likes - 1);
            item.likedBy = item.likedBy.filter(id => id !== deviceId);
            button.classList.remove('liked');
        } else {
            // Curtir
            item.likes = (item.likes || 0) + 1;
            if (!item.likedBy) item.likedBy = [];
            item.likedBy.push(deviceId);
            button.classList.add('liked');
            // Adiciona animação de pulsação
            const heartIcon = button.querySelector('i');
            heartIcon.classList.add('pulse');
            setTimeout(() => {
                heartIcon.classList.remove('pulse');
            }, 600);
        }
        // Atualiza o contador na interface
        const likeCount = button.querySelector('.lightbox-like-count, .text-lightbox-like-count');
        if (likeCount) {
            likeCount.textContent = item.likes;
        }
        // Atualiza o ícone
        const heartIcon = button.querySelector('i');
        heartIcon.className = hasLiked ? 'far fa-heart' : 'fas fa-heart';
        // Salva no Firebase
        const itensRef = database.ref('itens');
        itensRef.orderByChild('timestamp').equalTo(timestamp).once('value', (snapshot) => {
            snapshot.forEach((childSnapshot) => {
                childSnapshot.ref.update({
                    likes: item.likes,
                    likedBy: item.likedBy
                });
            });
        });
    }
    */
    function setupRealtimeGallery() {
        console.log("Iniciando configuração da galeria...");
        if (!database) {
            console.error("Firebase não inicializado corretamente.");
            if (loadingMessage) loadingMessage.textContent = "Erro ao carregar galeria.";
            return;
        }
        try {
            const itensRef = database.ref('itens');
            itensRef.once('value')
                .then(() => {
                    console.log("Conexão com Firebase estabelecida com sucesso.");
                    if (loadingMessage) loadingMessage.textContent = "Nenhum item encontrado.";
                })
                .catch(error => {
                    console.error("Erro ao conectar ao Firebase:", error);
                    if (loadingMessage) loadingMessage.textContent = "Erro ao carregar galeria.";
                });
            itensRef.orderByChild('timestamp').on('child_added', (snapshot) => {
                console.log("Novo item adicionado:", snapshot.key);
                const itemData = snapshot.val();
                if (itemData) {
                    addItemToGallery(itemData);
                }
            }, (error) => {
                console.error("Erro ao ouvir itens do Firebase:", error);
                if (loadingMessage) loadingMessage.textContent = "Erro ao carregar galeria.";
            });
            // 🔥 ESCUTA MUDANÇAS NAS CURTIDAS (REMOVIDA, MAS MANTIDA COMENTADA)
            /*
            itensRef.on('child_changed', (snapshot) => {
                const updatedData = snapshot.val();
                if (updatedData) {
                    const { timestamp, likes, likedBy } = updatedData;
                    // Atualiza nos arrays locais
                    [casamentoPhotos, mensagemVideos, textMessages].forEach(array => {
                        const index = array.findIndex(item => item.timestamp === timestamp);
                        if (index !== -1) {
                            array[index].likes = likes;
                            array[index].likedBy = likedBy;
                        }
                    });
                    // Atualiza na interface do lightbox se estiver aberto
                    const lightboxLikeButton = document.getElementById('lightboxLikeButton');
                    const lightboxLikeCount = document.getElementById('lightboxLikeButton')?.querySelector('.lightbox-like-count');
                    const textLightboxLikeButton = document.getElementById('textLightboxLikeButton');
                    const textLightboxLikeCount = document.getElementById('textLightboxLikeButton')?.querySelector('.text-lightbox-like-count');
                    // Verifica se o lightbox de imagem/vídeo está aberto e corresponde ao item atual
                    if (lightbox.style.display === 'flex') {
                        const currentTimestamp = document.getElementById('lightboxContent').dataset.timestamp;
                        if (currentTimestamp == timestamp) {
                            if (lightboxLikeCount) {
                                lightboxLikeCount.textContent = likes;
                            }
                            if (lightboxLikeButton && likedBy && likedBy.includes(deviceId)) {
                                lightboxLikeButton.classList.add('liked');
                                lightboxLikeButton.querySelector('i').className = 'fas fa-heart';
                            } else if (lightboxLikeButton) {
                                lightboxLikeButton.classList.remove('liked');
                                lightboxLikeButton.querySelector('i').className = 'far fa-heart';
                            }
                        }
                    }
                    // Verifica se o lightbox de texto está aberto e corresponde ao item atual
                    if (!document.getElementById('text-lightbox-bg').classList.contains('hidden')) {
                        const currentTextItem = textMessages[currentTextIndex];
                        if (currentTextItem && currentTextItem.timestamp == timestamp) {
                            if (textLightboxLikeCount) {
                                textLightboxLikeCount.textContent = likes;
                            }
                            if (textLightboxLikeButton && likedBy && likedBy.includes(deviceId)) {
                                textLightboxLikeButton.classList.add('liked');
                                textLightboxLikeButton.querySelector('i').className = 'fas fa-heart';
                            } else if (textLightboxLikeButton) {
                                textLightboxLikeButton.classList.remove('liked');
                                textLightboxLikeButton.querySelector('i').className = 'far fa-heart';
                            }
                        }
                    }
                }
            });
            */
            itensRef.on('error', (error) => {
                console.error("Erro na referência do Firebase:", error);
                if (loadingMessage) loadingMessage.textContent = "Erro ao carregar galeria.";
            });
        } catch (error) {
            console.error("Erro ao configurar a galeria:", error);
            if (loadingMessage) loadingMessage.textContent = "Erro ao carregar galeria.";
        }
        // 🔥 ADICIONA O BOTÃO "MEUS ENVIOS" DEPOIS DE "SÓ TEXTO"
        const textOnlyTab = document.querySelector('.filter-tab[data-filter="text_only"]');
        const meusEnviosTab = document.createElement('div');
        meusEnviosTab.className = 'filter-tab';
        meusEnviosTab.dataset.filter = 'meus_envios';
        meusEnviosTab.textContent = 'Meus Envios';
        meusEnviosTab.onclick = function() {
            filterGallery('meus_envios');
        };
        if (textOnlyTab) {
            galleryFilterTabs.insertBefore(meusEnviosTab, textOnlyTab.nextSibling);
        } else {
            galleryFilterTabs.appendChild(meusEnviosTab);
        }
        // 🔥 ATUALIZA O CONTADOR INICIAL APÓS UM PEQUENO DELAY
        setTimeout(() => {
            updateContentCounter();
        }, 1500);
    }
    // =============================
    // 🔥 NOVO SISTEMA DE TEXTO EM TELA CHEIA (REFATORADO DO ZERO)
    // =============================
    const textLightbox = document.getElementById('text-lightbox-bg');
    const textLightboxName = document.getElementById('text-lightbox-name');
    const textLightboxMessage = document.getElementById('text-lightbox-message');
    const textPrevBtn = document.getElementById('text-prev-btn');
    const textNextBtn = document.getElementById('text-next-btn');
    // 🔥 REMOVIDO: Referência ao botão de like
    // const textLightboxLikeButton = document.getElementById('textLightboxLikeButton');
    const textLightboxPostDate = document.getElementById('textLightboxPostDate');
    function openTextLightbox(index) {
        // Garante que o índice é válido
        if (index < 0 || index >= textMessages.length) return;
        // Atualiza o índice atual
        currentTextIndex = index;
        // Preenche os dados
        const item = textMessages[index];
        textLightboxName.textContent = item.name || 'Anônimo';
        textLightboxMessage.textContent = item.message || '';
        // 🔥 PREENCHE OS CONTROLES DE CURTIDA E DATA (REMOVIDO O LIKE)
        if (textLightboxPostDate) {
            textLightboxPostDate.textContent = formatDate(item.timestamp);
        }
        // Atualiza a visibilidade das setas
        updateTextNavButtons();
        // Mostra o modal
        textLightbox.classList.remove('hidden');
        document.body.style.overflow = "hidden";
    }
    function closeTextLightbox() {
        textLightbox.classList.add('hidden');
        document.body.style.overflow = "";
        currentTextIndex = -1; // Reseta o índice
    }
    function updateTextNavButtons() {
        if (currentTextIndex === 0) {
            textPrevBtn.disabled = true;
            textPrevBtn.classList.add('disabled');
        } else {
            textPrevBtn.disabled = false;
            textPrevBtn.classList.remove('disabled');
        }
        if (currentTextIndex === textMessages.length - 1) {
            textNextBtn.disabled = true;
            textNextBtn.classList.add('disabled');
        } else {
            textNextBtn.disabled = false;
            textNextBtn.classList.remove('disabled');
        }
    }
    function navigateTextLightbox(direction) {
        if (textMessages.length === 0 || currentTextIndex === -1) return;
        let newIndex = currentTextIndex;
        if (direction === 'next' && currentTextIndex < textMessages.length - 1) {
            newIndex = currentTextIndex + 1;
        } else if (direction === 'prev' && currentTextIndex > 0) {
            newIndex = currentTextIndex - 1;
        } else {
            // Se não houver próximo/anterior, não faz nada
            return;
        }
        openTextLightbox(newIndex);
    }
    // 🔥 Evento de swipe para mobile
    let startX = 0;
    textLightbox.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
    });
    textLightbox.addEventListener('touchend', (e) => {
        const endX = e.changedTouches[0].clientX;
        const diff = endX - startX;
        if (Math.abs(diff) > 50) {
            if (diff < 0) {
                navigateTextLightbox('next'); // Swipe para direita = próxima
            } else {
                navigateTextLightbox('prev'); // Swipe para esquerda = anterior
            }
        }
    });
    // 🔥 Fechar ao clicar fora
    textLightbox.addEventListener('click', (e) => {
        if (e.target === textLightbox) {
            closeTextLightbox();
        }
    });
    // 🔥 Fechar com ESC
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !textLightbox.classList.contains('hidden')) {
            closeTextLightbox();
        }
    });
    // =============================
    // 🔥 FIM DO NOVO SISTEMA DE TEXTO EM TELA CHEIA
    // =============================
    // =============================
    // 🖥️ LIGHTBOX PADRÃO (FOTOS/VÍDEOS) - MANTIDO INALTERADO
    // =============================
    const lightbox = document.getElementById("lightboxOverlay");
    const lightboxImage = document.getElementById("lightboxImage");
    const lightboxVideo = document.getElementById("lightboxVideo");
    const lightboxCaption = document.getElementById("lightboxCaption");
    const lightboxControls = document.getElementById("lightboxControls");
    // 🔥 REMOVIDO: Referência ao botão de like
    // const lightboxLikeButton = document.getElementById("lightboxLikeButton");
    const lightboxPostDate = document.getElementById("lightboxPostDate");
    function showLightbox(index, type) {
        lightboxImage.classList.add('hidden');
        lightboxVideo.classList.add('hidden');
        let photo = null;
        let array = [];
        if (type === 'image' || type === 'video') {
            array = casamentoPhotos;
            photo = array[index];
        } else if (type === 'video_message') {
            array = mensagemVideos;
            photo = array[index];
        }
        if (!photo) return;
        if (type === 'video' || type === 'video_message') {
            lightboxVideo.classList.remove('hidden');
            lightboxVideo.src = photo.url;
            lightboxVideo.load();
            lightboxCaption.innerHTML = `<strong>${photo.name || 'Anônimo'}</strong>`;
        } else {
            lightboxImage.classList.remove('hidden');
            lightboxImage.src = photo.url;
            lightboxCaption.innerHTML = `<strong>${photo.name || 'Anônimo'}</strong>`;
        }
        // 🔥 PREENCHE OS CONTROLES DE CURTIDA E DATA (REMOVIDO O LIKE)
        if (lightboxPostDate) {
            lightboxPostDate.textContent = formatDate(photo.timestamp);
        }
        // --- CORREÇÃO: Remove event listeners antigos dos botões de navegação ---
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
        const prevHandler = (e) => {
            e.stopPropagation();
            let array = [];
            let currentIndex = 0;
            if (currentFilter === 'casamento') {
                array = casamentoPhotos;
                currentIndex = currentPhotoIndex;
            } else if (currentFilter === 'mensagem') {
                array = mensagemVideos;
                currentIndex = currentMessageIndex;
            }
            if (array.length === 0) return;
            currentIndex = (currentIndex - 1 + array.length) % array.length;
            if (currentFilter === 'casamento') {
                currentPhotoIndex = currentIndex;
            } else if (currentFilter === 'mensagem') {
                currentMessageIndex = currentIndex;
            }
            showLightbox(currentIndex, array[currentIndex].type);
        };
        const nextHandler = (e) => {
            e.stopPropagation();
            let array = [];
            let currentIndex = 0;
            if (currentFilter === 'casamento') {
                array = casamentoPhotos;
                currentIndex = currentPhotoIndex;
            } else if (currentFilter === 'mensagem') {
                array = mensagemVideos;
                currentIndex = currentMessageIndex;
            }
            if (array.length === 0) return;
            currentIndex = (currentIndex + 1) % array.length;
            if (currentFilter === 'casamento') {
                currentPhotoIndex = currentIndex;
            } else if (currentFilter === 'mensagem') {
                currentMessageIndex = currentIndex;
            }
            showLightbox(currentIndex, array[currentIndex].type);
        };

        // Remove listeners antigos
        prevBtn.removeEventListener('click', prevHandler);
        nextBtn.removeEventListener('click', nextHandler);
        // Adiciona novos listeners
        prevBtn.addEventListener('click', prevHandler);
        nextBtn.addEventListener('click', nextHandler);
        // --- FIM DA CORREÇÃO ---

        lightbox.style.display = "flex";
        document.body.style.overflow = "hidden";
        // Atualiza botões de navegação
        updateNavButtons(type, index, array.length);
    }
    function updateNavButtons(type, currentIndex, totalItems) {
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
        if (currentIndex === 0) {
            prevBtn.style.display = "none";
        } else {
            prevBtn.style.display = "block";
        }
        if (currentIndex === totalItems - 1) {
            nextBtn.style.display = "none";
        } else {
            nextBtn.style.display = "block";
        }
    }
    document.getElementById("prevBtn").addEventListener("click", (e) => {
        e.stopPropagation();
        let array = [];
        let currentIndex = 0;
        if (currentFilter === 'casamento') {
            array = casamentoPhotos;
            currentIndex = currentPhotoIndex;
        } else if (currentFilter === 'mensagem') {
            array = mensagemVideos;
            currentIndex = currentMessageIndex;
        }
        if (array.length === 0) return;
        currentIndex = (currentIndex - 1 + array.length) % array.length;
        if (currentFilter === 'casamento') {
            currentPhotoIndex = currentIndex;
        } else if (currentFilter === 'mensagem') {
            currentMessageIndex = currentIndex;
        }
        showLightbox(currentIndex, array[currentIndex].type);
    });
    document.getElementById("nextBtn").addEventListener("click", (e) => {
        e.stopPropagation();
        let array = [];
        let currentIndex = 0;
        if (currentFilter === 'casamento') {
            array = casamentoPhotos;
            currentIndex = currentPhotoIndex;
        } else if (currentFilter === 'mensagem') {
            array = mensagemVideos;
            currentIndex = currentMessageIndex;
        }
        if (array.length === 0) return;
        currentIndex = (currentIndex + 1) % array.length;
        if (currentFilter === 'casamento') {
            currentPhotoIndex = currentIndex;
        } else if (currentFilter === 'mensagem') {
            currentMessageIndex = currentIndex;
        }
        showLightbox(currentIndex, array[currentIndex].type);
    });
    document.querySelector(".close-lightbox").addEventListener("click", (e) => {
        e.stopPropagation();
        closeLightbox();
    });
    lightbox.addEventListener("click", (e) => {
        if (e.target === lightbox) {
            closeLightbox();
        }
    });
    // Swipe para lightbox padrão
    const lightboxContent = document.getElementById("lightboxContent");
    lightboxContent.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
    });
    lightboxContent.addEventListener('touchend', (e) => {
      const endX = e.changedTouches[0].clientX;
      const diff = endX - startX;
      if (Math.abs(diff) > 50) {
        let array = [];
        let currentIndex = 0;
        if (currentFilter === 'casamento') {
            array = casamentoPhotos;
            currentIndex = currentPhotoIndex;
        } else if (currentFilter === 'mensagem') {
            array = mensagemVideos;
            currentIndex = currentMessageIndex;
        }
        if (array.length === 0) return;
        currentIndex = diff < 0 ? (currentIndex + 1) % array.length : (currentIndex - 1 + array.length) % array.length;
        if (currentFilter === 'casamento') {
            currentPhotoIndex = currentIndex;
        } else if (currentFilter === 'mensagem') {
            currentMessageIndex = currentIndex;
        }
        showLightbox(currentIndex, array[currentIndex].type);
      }
    });
    // 🔥 NOVAS FUNÇÕES IMPLEMENTADAS
    function updateContentCounter() {
        const photoCount = casamentoPhotos.length;
        const videoCount = mensagemVideos.length;
        const messageCount = textMessages.length;
        document.getElementById('photoCount').textContent = photoCount;
        document.getElementById('videoCount').textContent = videoCount;
        document.getElementById('messageCount').textContent = messageCount;
    }
    let isNavigationMode = false;
    function toggleNavigationMode() {
        isNavigationMode = !isNavigationMode;
        const btn = document.getElementById('navigationModeBtn');
        const textSpan = document.getElementById('navigationModeText');
        const body = document.body;
        if (isNavigationMode) {
            textSpan.textContent = 'Voltar ao Envio';
            btn.classList.add('active');
            body.classList.add('navigation-mode'); // 🔥 ADICIONA CLASSE PARA ESCONDER TUDO EXCETO O ESSENCIAL
        } else {
            textSpan.textContent = 'Modo Navegação';
            btn.classList.remove('active');
            body.classList.remove('navigation-mode'); // 🔥 REMOVE CLASSE PARA MOSTRAR TUDO
        }
    }
    function showConfetti() {
        confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 },
            colors: ['#f43f5e', '#1e3a8a', '#fbbf24', '#8b5cf6', '#10b981']
        });
    }
  </script>
</body>
</html>